!function(t){var n={};function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(i,o,function(n){return t[n]}.bind(null,o));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=15)}({0:function(t,n){var e;e=function(){return this}();try{e=e||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(e=window)}t.exports=e},15:function(t,n,e){"use strict";e.r(n);var i=e(2),o=e.n(i),r={android:function(){return navigator.userAgent.match(/Android/i)},blackberry:function(){return navigator.userAgent.match(/BlackBerry/i)},ios:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},opera:function(){return navigator.userAgent.match(/Opera Mini/i)},windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return r.android()||r.blackberry()||r.ios()||r.opera()||r.windows()}},s=r,a="http://www.w3.org/1999/xhtml",c={svg:"http://www.w3.org/2000/svg",xhtml:a,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},h=function(t){var n=t+="",e=n.indexOf(":");return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),c.hasOwnProperty(n)?{space:c[n],local:t}:t};var u=function(t){var n=h(t);return(n.local?function(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}:function(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===a&&n.documentElement.namespaceURI===a?n.createElement(t):n.createElementNS(e,t)}})(n)},l=0;function f(){this._="@"+(++l).toString(36)}f.prototype=function(){return new f}.prototype={constructor:f,get:function(t){for(var n=this._;!(n in t);)if(!(t=t.parentNode))return;return t[n]},set:function(t,n){return t[this._]=n},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var p=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var d=document.documentElement;if(!d.matches){var _=d.webkitMatchesSelector||d.msMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector;p=function(t){return function(){return _.call(this,t)}}}}var y=p,v={},g=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(v={mouseenter:"mouseover",mouseleave:"mouseout"}));function x(t,n,e){return t=m(t,n,e),function(n){var e=n.relatedTarget;e&&(e===this||8&e.compareDocumentPosition(this))||t.call(this,n)}}function m(t,n,e){return function(i){var o=g;g=i;try{t.call(this,this.__data__,n,e)}finally{g=o}}}function b(t){return function(){var n=this.__on;if(n){for(var e,i=0,o=-1,r=n.length;i<r;++i)e=n[i],t.type&&e.type!==t.type||e.name!==t.name?n[++o]=e:this.removeEventListener(e.type,e.listener,e.capture);++o?n.length=o:delete this.__on}}}function w(t,n,e){var i=v.hasOwnProperty(t.type)?x:m;return function(o,r,s){var a,c=this.__on,h=i(n,r,s);if(c)for(var u=0,l=c.length;u<l;++u)if((a=c[u]).type===t.type&&a.name===t.name)return this.removeEventListener(a.type,a.listener,a.capture),this.addEventListener(a.type,a.listener=h,a.capture=e),void(a.value=n);this.addEventListener(t.type,h,e),a={type:t.type,name:t.name,value:n,listener:h,capture:e},c?c.push(a):this.__on=[a]}}function M(t,n,e,i){var o=g;t.sourceEvent=g,g=t;try{return n.apply(e,i)}finally{g=o}}var k=function(){for(var t,n=g;t=n.sourceEvent;)n=t;return n},S=function(t,n){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var i=e.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}var o=t.getBoundingClientRect();return[n.clientX-o.left-t.clientLeft,n.clientY-o.top-t.clientTop]},j=function(t){var n=k();return n.changedTouches&&(n=n.changedTouches[0]),S(t,n)};function T(){}var E=function(t){return null==t?T:function(){return this.querySelector(t)}};function N(){return[]}var O=function(t){return new Array(t.length)};function A(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}A.prototype={constructor:A,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var P="$";function C(t,n,e,i,o,r){for(var s,a=0,c=n.length,h=r.length;a<h;++a)(s=n[a])?(s.__data__=r[a],i[a]=s):e[a]=new A(t,r[a]);for(;a<c;++a)(s=n[a])&&(o[a]=s)}function R(t,n,e,i,o,r,s){var a,c,h,u={},l=n.length,f=r.length,p=new Array(l);for(a=0;a<l;++a)(c=n[a])&&(p[a]=h=P+s.call(c,c.__data__,a,n),h in u?o[a]=c:u[h]=c);for(a=0;a<f;++a)(c=u[h=P+s.call(t,r[a],a,r)])?(i[a]=c,c.__data__=r[a],u[h]=null):e[a]=new A(t,r[a]);for(a=0;a<l;++a)(c=n[a])&&u[p[a]]===c&&(o[a]=c)}function I(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}var B=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function L(t){return t.trim().split(/^|\s+/)}function q(t){return t.classList||new H(t)}function H(t){this._node=t,this._names=L(t.getAttribute("class")||"")}function z(t,n){for(var e=q(t),i=-1,o=n.length;++i<o;)e.add(n[i])}function D(t,n){for(var e=q(t),i=-1,o=n.length;++i<o;)e.remove(n[i])}H.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function W(){this.textContent=""}function Y(){this.innerHTML=""}function F(){this.nextSibling&&this.parentNode.appendChild(this)}function X(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function V(){return null}function J(){var t=this.parentNode;t&&t.removeChild(this)}function U(t,n,e){var i=B(t),o=i.CustomEvent;o?o=new o(n,e):(o=i.document.createEvent("Event"),e?(o.initEvent(n,e.bubbles,e.cancelable),o.detail=e.detail):o.initEvent(n,!1,!1)),t.dispatchEvent(o)}var G=[null];function $(t,n){this._groups=t,this._parents=n}function Z(){return new $([[document.documentElement]],G)}$.prototype=Z.prototype={constructor:$,select:function(t){"function"!=typeof t&&(t=E(t));for(var n=this._groups,e=n.length,i=new Array(e),o=0;o<e;++o)for(var r,s,a=n[o],c=a.length,h=i[o]=new Array(c),u=0;u<c;++u)(r=a[u])&&(s=t.call(r,r.__data__,u,a))&&("__data__"in r&&(s.__data__=r.__data__),h[u]=s);return new $(i,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=function(t){return null==t?N:function(){return this.querySelectorAll(t)}}(t));for(var n=this._groups,e=n.length,i=[],o=[],r=0;r<e;++r)for(var s,a=n[r],c=a.length,h=0;h<c;++h)(s=a[h])&&(i.push(t.call(s,s.__data__,h,a)),o.push(s));return new $(i,o)},filter:function(t){"function"!=typeof t&&(t=y(t));for(var n=this._groups,e=n.length,i=new Array(e),o=0;o<e;++o)for(var r,s=n[o],a=s.length,c=i[o]=[],h=0;h<a;++h)(r=s[h])&&t.call(r,r.__data__,h,s)&&c.push(r);return new $(i,this._parents)},data:function(t,n){if(!t)return p=new Array(this.size()),h=-1,this.each(function(t){p[++h]=t}),p;var e=n?R:C,i=this._parents,o=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var r=o.length,s=new Array(r),a=new Array(r),c=new Array(r),h=0;h<r;++h){var u=i[h],l=o[h],f=l.length,p=t.call(u,u&&u.__data__,h,i),d=p.length,_=a[h]=new Array(d),y=s[h]=new Array(d);e(u,l,_,y,c[h]=new Array(f),p,n);for(var v,g,x=0,m=0;x<d;++x)if(v=_[x]){for(x>=m&&(m=x+1);!(g=y[m])&&++m<d;);v._next=g||null}}return(s=new $(s,i))._enter=a,s._exit=c,s},enter:function(){return new $(this._enter||this._groups.map(O),this._parents)},exit:function(){return new $(this._exit||this._groups.map(O),this._parents)},merge:function(t){for(var n=this._groups,e=t._groups,i=n.length,o=e.length,r=Math.min(i,o),s=new Array(i),a=0;a<r;++a)for(var c,h=n[a],u=e[a],l=h.length,f=s[a]=new Array(l),p=0;p<l;++p)(c=h[p]||u[p])&&(f[p]=c);for(;a<i;++a)s[a]=n[a];return new $(s,this._parents)},order:function(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var i,o=t[n],r=o.length-1,s=o[r];--r>=0;)(i=o[r])&&(s&&s!==i.nextSibling&&s.parentNode.insertBefore(i,s),s=i);return this},sort:function(t){function n(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}t||(t=I);for(var e=this._groups,i=e.length,o=new Array(i),r=0;r<i;++r){for(var s,a=e[r],c=a.length,h=o[r]=new Array(c),u=0;u<c;++u)(s=a[u])&&(h[u]=s);h.sort(n)}return new $(o,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),n=-1;return this.each(function(){t[++n]=this}),t},node:function(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var i=t[n],o=0,r=i.length;o<r;++o){var s=i[o];if(s)return s}return null},size:function(){var t=0;return this.each(function(){++t}),t},empty:function(){return!this.node()},each:function(t){for(var n=this._groups,e=0,i=n.length;e<i;++e)for(var o,r=n[e],s=0,a=r.length;s<a;++s)(o=r[s])&&t.call(o,o.__data__,s,r);return this},attr:function(t,n){var e=h(t);if(arguments.length<2){var i=this.node();return e.local?i.getAttributeNS(e.space,e.local):i.getAttribute(e)}return this.each((null==n?e.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}}:"function"==typeof n?e.local?function(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}:function(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}}:e.local?function(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}:function(t,n){return function(){this.setAttribute(t,n)}})(e,n))},style:function(t,n,e){var i;return arguments.length>1?this.each((null==n?function(t){return function(){this.style.removeProperty(t)}}:"function"==typeof n?function(t,n,e){return function(){var i=n.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,e)}}:function(t,n,e){return function(){this.style.setProperty(t,n,e)}})(t,n,null==e?"":e)):B(i=this.node()).getComputedStyle(i,null).getPropertyValue(t)},property:function(t,n){return arguments.length>1?this.each((null==n?function(t){return function(){delete this[t]}}:"function"==typeof n?function(t,n){return function(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}}:function(t,n){return function(){this[t]=n}})(t,n)):this.node()[t]},classed:function(t,n){var e=L(t+"");if(arguments.length<2){for(var i=q(this.node()),o=-1,r=e.length;++o<r;)if(!i.contains(e[o]))return!1;return!0}return this.each(("function"==typeof n?function(t,n){return function(){(n.apply(this,arguments)?z:D)(this,t)}}:n?function(t){return function(){z(this,t)}}:function(t){return function(){D(this,t)}})(e,n))},text:function(t){return arguments.length?this.each(null==t?W:("function"==typeof t?function(t){return function(){var n=t.apply(this,arguments);this.textContent=null==n?"":n}}:function(t){return function(){this.textContent=t}})(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Y:("function"==typeof t?function(t){return function(){var n=t.apply(this,arguments);this.innerHTML=null==n?"":n}}:function(t){return function(){this.innerHTML=t}})(t)):this.node().innerHTML},raise:function(){return this.each(F)},lower:function(){return this.each(X)},append:function(t){var n="function"==typeof t?t:u(t);return this.select(function(){return this.appendChild(n.apply(this,arguments))})},insert:function(t,n){var e="function"==typeof t?t:u(t),i=null==n?V:"function"==typeof n?n:E(n);return this.select(function(){return this.insertBefore(e.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(J)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,n,e){var i,o,r=function(t){return t.trim().split(/^|\s+/).map(function(t){var n="",e=t.indexOf(".");return e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),{type:t,name:n}})}(t+""),s=r.length;if(!(arguments.length<2)){for(a=n?w:b,null==e&&(e=!1),i=0;i<s;++i)this.each(a(r[i],n,e));return this}var a=this.node().__on;if(a)for(var c,h=0,u=a.length;h<u;++h)for(i=0,c=a[h];i<s;++i)if((o=r[i]).type===c.type&&o.name===c.name)return c.value},dispatch:function(t,n){return this.each(("function"==typeof n?function(t,n){return function(){return U(this,t,n.apply(this,arguments))}}:function(t,n){return function(){return U(this,t,n)}})(t,n))}};var Q=function(t){return"string"==typeof t?new $([[document.querySelector(t)]],[document.documentElement]):new $([[t]],G)},K=function(t,n,e){arguments.length<3&&(e=n,n=k().changedTouches);for(var i,o=0,r=n?n.length:0;o<r;++o)if((i=n[o]).identifier===e)return S(t,i);return null},tt={value:function(){}};function nt(){for(var t,n=0,e=arguments.length,i={};n<e;++n){if(!(t=arguments[n]+"")||t in i)throw new Error("illegal type: "+t);i[t]=[]}return new et(i)}function et(t){this._=t}function it(t,n){for(var e,i=0,o=t.length;i<o;++i)if((e=t[i]).name===n)return e.value}function ot(t,n,e){for(var i=0,o=t.length;i<o;++i)if(t[i].name===n){t[i]=tt,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=e&&t.push({name:n,value:e}),t}et.prototype=nt.prototype={constructor:et,on:function(t,n){var e,i=this._,o=function(t,n){return t.trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})}(t+"",i),r=-1,s=o.length;if(!(arguments.length<2)){if(null!=n&&"function"!=typeof n)throw new Error("invalid callback: "+n);for(;++r<s;)if(e=(t=o[r]).type)i[e]=ot(i[e],t.name,n);else if(null==n)for(e in i)i[e]=ot(i[e],t.name,null);return this}for(;++r<s;)if((e=(t=o[r]).type)&&(e=it(i[e],t.name)))return e},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new et(t)},call:function(t,n){if((e=arguments.length-2)>0)for(var e,i,o=new Array(e),r=0;r<e;++r)o[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(r=0,e=(i=this._[t]).length;r<e;++r)i[r].value.apply(n,o)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],o=0,r=i.length;o<r;++o)i[o].value.apply(n,e)}};var rt=nt;function st(){g.stopImmediatePropagation()}var at=function(){g.preventDefault(),g.stopImmediatePropagation()},ct=function(t){var n=t.document.documentElement,e=Q(t).on("dragstart.drag",at,!0);"onselectstart"in n?e.on("selectstart.drag",at,!0):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")};var ht=function(t){return function(){return t}};function ut(t,n,e,i,o,r,s,a,c,h){this.target=t,this.type=n,this.subject=e,this.identifier=i,this.active=o,this.x=r,this.y=s,this.dx=a,this.dy=c,this._=h}function lt(){return!g.button}function ft(){return this.parentNode}function pt(t){return null==t?{x:g.x,y:g.y}:t}ut.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var dt=function(){var t,n,e=lt,i=ft,o=pt,r={},s=rt("start","drag","end"),a=0;function c(t){t.on("mousedown.drag",h).on("touchstart.drag",f).on("touchmove.drag",p).on("touchend.drag touchcancel.drag",d).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(){if(!n&&e.apply(this,arguments)){var o=_("mouse",i.apply(this,arguments),j,this,arguments);o&&(Q(g.view).on("mousemove.drag",u,!0).on("mouseup.drag",l,!0),ct(g.view),st(),t=!1,o("start"))}}function u(){at(),t=!0,r.mouse("drag")}function l(){Q(g.view).on("mousemove.drag mouseup.drag",null),function(t,n){var e=t.document.documentElement,i=Q(t).on("dragstart.drag",null);n&&(i.on("click.drag",at,!0),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in e?i.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}(g.view,t),at(),r.mouse("end")}function f(){if(e.apply(this,arguments)){var t,n,o=g.changedTouches,r=i.apply(this,arguments),s=o.length;for(t=0;t<s;++t)(n=_(o[t].identifier,r,K,this,arguments))&&(st(),n("start"))}}function p(){var t,n,e=g.changedTouches,i=e.length;for(t=0;t<i;++t)(n=r[e[t].identifier])&&(at(),n("drag"))}function d(){var t,e,i=g.changedTouches,o=i.length;for(n&&clearTimeout(n),n=setTimeout(function(){n=null},500),t=0;t<o;++t)(e=r[i[t].identifier])&&(st(),e("end"))}function _(t,n,e,i,h){var u,l,f,p=e(n,t),d=s.copy();if(M(new ut(c,"beforestart",u,t,a,p[0],p[1],0,0,d),function(){return null!=(g.subject=u=o.apply(i,h))&&(l=u.x-p[0]||0,f=u.y-p[1]||0,!0)}))return function o(s){var _,y=p;switch(s){case"start":r[t]=o,_=a++;break;case"end":delete r[t],--a;case"drag":p=e(n,t),_=a}M(new ut(c,s,u,t,_,p[0]+l,p[1]+f,p[0]-y[0],p[1]-y[1],d),d.apply,d,[s,i,h])}}return c.filter=function(t){return arguments.length?(e="function"==typeof t?t:ht(!!t),c):e},c.container=function(t){return arguments.length?(i="function"==typeof t?t:ht(t),c):i},c.subject=function(t){return arguments.length?(o="function"==typeof t?t:ht(t),c):o},c.on=function(){var t=s.on.apply(s,arguments);return t===s?c:t},c},_t=Math.PI,yt=2*_t,vt=yt-1e-6;function gt(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function xt(){return new gt}gt.prototype=xt.prototype={constructor:gt,moveTo:function(t,n){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+n)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,n){this._+="L"+(this._x1=+t)+","+(this._y1=+n)},quadraticCurveTo:function(t,n,e,i){this._+="Q"+ +t+","+ +n+","+(this._x1=+e)+","+(this._y1=+i)},bezierCurveTo:function(t,n,e,i,o,r){this._+="C"+ +t+","+ +n+","+ +e+","+ +i+","+(this._x1=+o)+","+(this._y1=+r)},arcTo:function(t,n,e,i,o){t=+t,n=+n,e=+e,i=+i,o=+o;var r=this._x1,s=this._y1,a=e-t,c=i-n,h=r-t,u=s-n,l=h*h+u*u;if(o<0)throw new Error("negative radius: "+o);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=n);else if(l>1e-6)if(Math.abs(u*a-c*h)>1e-6&&o){var f=e-r,p=i-s,d=a*a+c*c,_=f*f+p*p,y=Math.sqrt(d),v=Math.sqrt(l),g=o*Math.tan((_t-Math.acos((d+l-_)/(2*y*v)))/2),x=g/v,m=g/y;Math.abs(x-1)>1e-6&&(this._+="L"+(t+x*h)+","+(n+x*u)),this._+="A"+o+","+o+",0,0,"+ +(u*f>h*p)+","+(this._x1=t+m*a)+","+(this._y1=n+m*c)}else this._+="L"+(this._x1=t)+","+(this._y1=n);else;},arc:function(t,n,e,i,o,r){t=+t,n=+n;var s=(e=+e)*Math.cos(i),a=e*Math.sin(i),c=t+s,h=n+a,u=1^r,l=r?i-o:o-i;if(e<0)throw new Error("negative radius: "+e);null===this._x1?this._+="M"+c+","+h:(Math.abs(this._x1-c)>1e-6||Math.abs(this._y1-h)>1e-6)&&(this._+="L"+c+","+h),e&&(l<0&&(l=l%yt+yt),l>vt?this._+="A"+e+","+e+",0,1,"+u+","+(t-s)+","+(n-a)+"A"+e+","+e+",0,1,"+u+","+(this._x1=c)+","+(this._y1=h):l>1e-6&&(this._+="A"+e+","+e+",0,"+ +(l>=_t)+","+u+","+(this._x1=t+e*Math.cos(o))+","+(this._y1=n+e*Math.sin(o))))},rect:function(t,n,e,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+n)+"h"+ +e+"v"+ +i+"h"+-e+"Z"},toString:function(){return this._}};var mt=xt,bt=function(t){return function(){return t}},wt=1e-12,Mt=Math.PI,kt=Mt/2,St=2*Mt;function jt(t){return t.innerRadius}function Tt(t){return t.outerRadius}function Et(t){return t.startAngle}function Nt(t){return t.endAngle}function Ot(t){return t&&t.padAngle}function At(t){return t>=1?kt:t<=-1?-kt:Math.asin(t)}function Pt(t,n,e,i,o,r,s){var a=t-e,c=n-i,h=(s?r:-r)/Math.sqrt(a*a+c*c),u=h*c,l=-h*a,f=t+u,p=n+l,d=e+u,_=i+l,y=(f+d)/2,v=(p+_)/2,g=d-f,x=_-p,m=g*g+x*x,b=o-r,w=f*_-d*p,M=(x<0?-1:1)*Math.sqrt(Math.max(0,b*b*m-w*w)),k=(w*x-g*M)/m,S=(-w*g-x*M)/m,j=(w*x+g*M)/m,T=(-w*g+x*M)/m,E=k-y,N=S-v,O=j-y,A=T-v;return E*E+N*N>O*O+A*A&&(k=j,S=T),{cx:k,cy:S,x01:-u,y01:-l,x11:k*(o/b-1),y11:S*(o/b-1)}}function Ct(t){this._context=t}Ct.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:this._context.lineTo(t,n)}}};var Rt=function(t){return new Ct(t)};function It(t){return t[0]}function Bt(t){return t[1]}var Lt=function(){var t=It,n=Bt,e=bt(!0),i=null,o=Rt,r=null;function s(s){var a,c,h,u=s.length,l=!1;for(null==i&&(r=o(h=mt())),a=0;a<=u;++a)!(a<u&&e(c=s[a],a,s))===l&&((l=!l)?r.lineStart():r.lineEnd()),l&&r.point(+t(c,a,s),+n(c,a,s));if(h)return r=null,h+""||null}return s.x=function(n){return arguments.length?(t="function"==typeof n?n:bt(+n),s):t},s.y=function(t){return arguments.length?(n="function"==typeof t?t:bt(+t),s):n},s.defined=function(t){return arguments.length?(e="function"==typeof t?t:bt(!!t),s):e},s.curve=function(t){return arguments.length?(o=t,null!=i&&(r=o(i)),s):o},s.context=function(t){return arguments.length?(null==t?i=r=null:r=o(i=t),s):i},s};Ht(Rt);function qt(t){this._curve=t}function Ht(t){function n(n){return new qt(t(n))}return n._curve=t,n}qt.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,n){this._curve.point(n*Math.sin(t),n*-Math.cos(t))}};Math.sqrt(1/3);var zt=Math.sin(Mt/10)/Math.sin(7*Mt/10),Dt=(Math.sin(St/10),Math.cos(St/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12),function(){});function Wt(t,n,e){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+n)/6,(t._y0+4*t._y1+e)/6)}function Yt(t){this._context=t}Yt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Wt(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Wt(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}};function Ft(t){this._context=t}Ft.prototype={areaStart:Dt,areaEnd:Dt,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._x2=t,this._y2=n;break;case 1:this._point=2,this._x3=t,this._y3=n;break;case 2:this._point=3,this._x4=t,this._y4=n,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+n)/6);break;default:Wt(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}};function Xt(t){this._context=t}Xt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var e=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+n)/6;this._line?this._context.lineTo(e,i):this._context.moveTo(e,i);break;case 3:this._point=4;default:Wt(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}};function Vt(t,n){this._basis=new Yt(t),this._beta=n}Vt.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,n=this._y,e=t.length-1;if(e>0)for(var i,o=t[0],r=n[0],s=t[e]-o,a=n[e]-r,c=-1;++c<=e;)i=c/e,this._basis.point(this._beta*t[c]+(1-this._beta)*(o+i*s),this._beta*n[c]+(1-this._beta)*(r+i*a));this._x=this._y=null,this._basis.lineEnd()},point:function(t,n){this._x.push(+t),this._y.push(+n)}};(function t(n){function e(t){return 1===n?new Yt(t):new Vt(t,n)}return e.beta=function(n){return t(+n)},e})(.85);function Jt(t,n,e){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-n),t._y2+t._k*(t._y1-e),t._x2,t._y2)}function Ut(t,n){this._context=t,this._k=(1-n)/6}Ut.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Jt(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2,this._x1=t,this._y1=n;break;case 2:this._point=3;default:Jt(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};(function t(n){function e(t){return new Ut(t,n)}return e.tension=function(n){return t(+n)},e})(0);function Gt(t,n){this._context=t,this._k=(1-n)/6}Gt.prototype={areaStart:Dt,areaEnd:Dt,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._x3=t,this._y3=n;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=n);break;case 2:this._point=3,this._x5=t,this._y5=n;break;default:Jt(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};(function t(n){function e(t){return new Gt(t,n)}return e.tension=function(n){return t(+n)},e})(0);function $t(t,n){this._context=t,this._k=(1-n)/6}$t.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Jt(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};(function t(n){function e(t){return new $t(t,n)}return e.tension=function(n){return t(+n)},e})(0);function Zt(t,n,e){var i=t._x1,o=t._y1,r=t._x2,s=t._y2;if(t._l01_a>wt){var a=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,c=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*a-t._x0*t._l12_2a+t._x2*t._l01_2a)/c,o=(o*a-t._y0*t._l12_2a+t._y2*t._l01_2a)/c}if(t._l23_a>wt){var h=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,u=3*t._l23_a*(t._l23_a+t._l12_a);r=(r*h+t._x1*t._l23_2a-n*t._l12_2a)/u,s=(s*h+t._y1*t._l23_2a-e*t._l12_2a)/u}t._context.bezierCurveTo(i,o,r,s,t._x2,t._y2)}function Qt(t,n){this._context=t,this._alpha=n}Qt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,i=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3;default:Zt(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var Kt=function t(n){function e(t){return n?new Qt(t,n):new Ut(t,0)}return e.alpha=function(n){return t(+n)},e}(.5);function tn(t,n){this._context=t,this._alpha=n}tn.prototype={areaStart:Dt,areaEnd:Dt,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,i=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=n;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=n);break;case 2:this._point=3,this._x5=t,this._y5=n;break;default:Zt(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};(function t(n){function e(t){return n?new tn(t,n):new Gt(t,0)}return e.alpha=function(n){return t(+n)},e})(.5);function nn(t,n){this._context=t,this._alpha=n}nn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,i=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Zt(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};(function t(n){function e(t){return n?new nn(t,n):new $t(t,0)}return e.alpha=function(n){return t(+n)},e})(.5);function en(t){this._context=t}en.prototype={areaStart:Dt,areaEnd:Dt,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,n){t=+t,n=+n,this._point?this._context.lineTo(t,n):(this._point=1,this._context.moveTo(t,n))}};function on(t){return t<0?-1:1}function rn(t,n,e){var i=t._x1-t._x0,o=n-t._x1,r=(t._y1-t._y0)/(i||o<0&&-0),s=(e-t._y1)/(o||i<0&&-0),a=(r*o+s*i)/(i+o);return(on(r)+on(s))*Math.min(Math.abs(r),Math.abs(s),.5*Math.abs(a))||0}function sn(t,n){var e=t._x1-t._x0;return e?(3*(t._y1-t._y0)/e-n)/2:n}function an(t,n,e){var i=t._x0,o=t._y0,r=t._x1,s=t._y1,a=(r-i)/3;t._context.bezierCurveTo(i+a,o+a*n,r-a,s-a*e,r,s)}function cn(t){this._context=t}function hn(t){this._context=new un(t)}function un(t){this._context=t}function ln(t){this._context=t}function fn(t){var n,e,i=t.length-1,o=new Array(i),r=new Array(i),s=new Array(i);for(o[0]=0,r[0]=2,s[0]=t[0]+2*t[1],n=1;n<i-1;++n)o[n]=1,r[n]=4,s[n]=4*t[n]+2*t[n+1];for(o[i-1]=2,r[i-1]=7,s[i-1]=8*t[i-1]+t[i],n=1;n<i;++n)e=o[n]/r[n-1],r[n]-=e,s[n]-=e*s[n-1];for(o[i-1]=s[i-1]/r[i-1],n=i-2;n>=0;--n)o[n]=(s[n]-o[n+1])/r[n];for(r[i-1]=(t[i]+o[i-1])/2,n=0;n<i-1;++n)r[n]=2*t[n+1]-o[n+1];return[o,r]}cn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:an(this,this._t0,sn(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){var e=NaN;if(n=+n,(t=+t)!==this._x1||n!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,an(this,sn(this,e=rn(this,t,n)),e);break;default:an(this,this._t0,e=rn(this,t,n))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n,this._t0=e}}},(hn.prototype=Object.create(cn.prototype)).point=function(t,n){cn.prototype.point.call(this,n,t)},un.prototype={moveTo:function(t,n){this._context.moveTo(n,t)},closePath:function(){this._context.closePath()},lineTo:function(t,n){this._context.lineTo(n,t)},bezierCurveTo:function(t,n,e,i,o,r){this._context.bezierCurveTo(n,t,i,e,r,o)}},ln.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,n=this._y,e=t.length;if(e)if(this._line?this._context.lineTo(t[0],n[0]):this._context.moveTo(t[0],n[0]),2===e)this._context.lineTo(t[1],n[1]);else for(var i=fn(t),o=fn(n),r=0,s=1;s<e;++r,++s)this._context.bezierCurveTo(i[0][r],o[0][r],i[1][r],o[1][r],t[s],n[s]);(this._line||0!==this._line&&1===e)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,n){this._x.push(+t),this._y.push(+n)}};function pn(t,n){this._context=t,this._t=n}pn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(t,n);else{var e=this._x*(1-this._t)+t*this._t;this._context.lineTo(e,this._y),this._context.lineTo(e,n)}}this._x=t,this._y=n}};Array.prototype.slice;var dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_n=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},yn=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),vn=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},gn=function t(n,e,i){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,e);if(void 0===o){var r=Object.getPrototypeOf(n);return null===r?void 0:t(r,e,i)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(i):void 0},xn=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},mn=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},bn=function(){function t(n){var e=n.x,i=void 0===e?0:e,o=n.y,r=void 0===o?0:o,s=n.nx,a=n.ny,c=n.dy,h=void 0===c?0:c,u=n.dx,l=void 0===u?0:u,f=n.color,p=void 0===f?"grey":f,d=n.data,_=n.type,y=n.subject,v=n.connector,g=n.note,x=n.disable,m=n.id,b=n.className;_n(this,t),this._dx=void 0!==s?s-i:l,this._dy=void 0!==a?a-r:h,this._x=i,this._y=r,this._color=p,this.id=m,this._className=b||"",this._type=_||"",this.data=d,this.note=g||{},this.connector=v||{},this.subject=y||{},this.disable=x||[]}return yn(t,[{key:"updatePosition",value:function(){this.type.setPosition&&(this.type.setPosition(),this.type.subject&&0!==this.type.subject.selectAll(":not(.handle)").nodes().length&&this.type.redrawSubject())}},{key:"clearComponents",value:function(){this.type.clearComponents&&this.type.clearComponents()}},{key:"updateOffset",value:function(){this.type.setOffset&&(this.type.setOffset(),0!==this.type.connector.selectAll(":not(.handle)").nodes().length&&this.type.redrawConnector(),this.type.redrawNote())}},{key:"className",get:function(){return this._className},set:function(t){this._className=t,this.type.setClassName&&this.type.setClassName()}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this.clearComponents()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.updatePosition()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.updatePosition()}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this.updatePosition()}},{key:"dx",get:function(){return this._dx},set:function(t){this._dx=t,this.updateOffset()}},{key:"dy",get:function(){return this._dy},set:function(t){this._dy=t,this.updateOffset()}},{key:"nx",set:function(t){this._dx=t-this._x,this.updateOffset()}},{key:"ny",set:function(t){this._dy=t-this._y,this.updateOffset()}},{key:"offset",get:function(){return{x:this._dx,y:this._dy}},set:function(t){var n=t.x,e=t.y;this._dx=n,this._dy=e,this.updateOffset()}},{key:"position",get:function(){return{x:this._x,y:this._y}},set:function(t){var n=t.x,e=t.y;this._x=n,this._y=e,this.updatePosition()}},{key:"translation",get:function(){return{x:this._x+this._dx,y:this._y+this._dy}}},{key:"json",get:function(){var t={x:this._x,y:this._y,dx:this._dx,dy:this._dy};return this.data&&Object.keys(this.data).length>0&&(t.data=this.data),this.type&&(t.type=this.type),this._className&&(t.className=this._className),Object.keys(this.connector).length>0&&(t.connector=this.connector),Object.keys(this.subject).length>0&&(t.subject=this.subject),Object.keys(this.note).length>0&&(t.note=this.note),t}}]),t}(),wn=function(){function t(n){var e=n.annotations,i=n.accessors,o=n.accessorsInverse;_n(this,t),this.accessors=i,this.accessorsInverse=o,this.annotations=e}return yn(t,[{key:"clearTypes",value:function(t){this.annotations.forEach(function(n){n.type=void 0,n.subject=t&&t.subject||n.subject,n.connector=t&&t.connector||n.connector,n.note=t&&t.note||n.note})}},{key:"setPositionWithAccessors",value:function(){var t=this;this.annotations.forEach(function(n){n.type.setPositionWithAccessors(t.accessors)})}},{key:"editMode",value:function(t){this.annotations.forEach(function(n){n.type&&(n.type.editMode=t,n.type.updateEditMode())})}},{key:"updateDisable",value:function(t){this.annotations.forEach(function(n){n.disable=t,n.type&&t.forEach(function(t){n.type[t]&&(n.type[t].remove&&n.type[t].remove(),n.type[t]=void 0)})})}},{key:"updateTextWrap",value:function(t){this.annotations.forEach(function(n){n.type&&n.type.updateTextWrap&&n.type.updateTextWrap(t)})}},{key:"updateText",value:function(){this.annotations.forEach(function(t){t.type&&t.type.drawText&&t.type.drawText()})}},{key:"updateNotePadding",value:function(t){this.annotations.forEach(function(n){n.type&&(n.type.notePadding=t)})}},{key:"json",get:function(){var t=this;return this.annotations.map(function(n){var e=n.json;return t.accessorsInverse&&n.data&&(e.data={},Object.keys(t.accessorsInverse).forEach(function(i){e.data[i]=t.accessorsInverse[i]({x:n.x,y:n.y})})),e})}},{key:"noteNodes",get:function(){return this.annotations.map(function(t){return vn({},t.type.getNoteBBoxOffset(),{positionX:t.x,positionY:t.y})})}}]),t}(),Mn=function(t,n){return"dynamic"!==t&&"left"!==t&&"right"!==t||(t=n<0?"top":"bottom"),t},kn=function(t,n){return"dynamic"!==t&&"top"!==t&&"bottom"!==t||(t=n<0?"right":"left"),t},Sn=["topBottom","top","bottom"],jn=["leftRight","left","right"],Tn=function(t){var n=t.data,e=t.curve,i=void 0===e?Rt:e,o=t.canvasContext,r=t.className,s=t.classID,a=Lt().curve(i),c={type:"path",className:r,classID:s,data:n};return o?(a.context(o),c.pathMethods=a):c.attrs={d:a(n)},c},En=function(t){var n=t.data,e=t.canvasContext,i={type:"path",className:t.className,classID:t.classID,data:n},o=function(){var t=jt,n=Tt,e=bt(0),i=null,o=Et,r=Nt,s=Ot,a=null;function c(){var c,h,u=+t.apply(this,arguments),l=+n.apply(this,arguments),f=o.apply(this,arguments)-kt,p=r.apply(this,arguments)-kt,d=Math.abs(p-f),_=p>f;if(a||(a=c=mt()),l<u&&(h=l,l=u,u=h),l>wt)if(d>St-wt)a.moveTo(l*Math.cos(f),l*Math.sin(f)),a.arc(0,0,l,f,p,!_),u>wt&&(a.moveTo(u*Math.cos(p),u*Math.sin(p)),a.arc(0,0,u,p,f,_));else{var y,v,g=f,x=p,m=f,b=p,w=d,M=d,k=s.apply(this,arguments)/2,S=k>wt&&(i?+i.apply(this,arguments):Math.sqrt(u*u+l*l)),j=Math.min(Math.abs(l-u)/2,+e.apply(this,arguments)),T=j,E=j;if(S>wt){var N=At(S/u*Math.sin(k)),O=At(S/l*Math.sin(k));(w-=2*N)>wt?(m+=N*=_?1:-1,b-=N):(w=0,m=b=(f+p)/2),(M-=2*O)>wt?(g+=O*=_?1:-1,x-=O):(M=0,g=x=(f+p)/2)}var A=l*Math.cos(g),P=l*Math.sin(g),C=u*Math.cos(b),R=u*Math.sin(b);if(j>wt){var I=l*Math.cos(x),B=l*Math.sin(x),L=u*Math.cos(m),q=u*Math.sin(m);if(d<Mt){var H=w>wt?function(t,n,e,i,o,r,s,a){var c=e-t,h=i-n,u=s-o,l=a-r,f=(u*(n-r)-l*(t-o))/(l*c-u*h);return[t+f*c,n+f*h]}(A,P,L,q,I,B,C,R):[C,R],z=A-H[0],D=P-H[1],W=I-H[0],Y=B-H[1],F=1/Math.sin(Math.acos((z*W+D*Y)/(Math.sqrt(z*z+D*D)*Math.sqrt(W*W+Y*Y)))/2),X=Math.sqrt(H[0]*H[0]+H[1]*H[1]);T=Math.min(j,(u-X)/(F-1)),E=Math.min(j,(l-X)/(F+1))}}M>wt?E>wt?(y=Pt(L,q,A,P,l,E,_),v=Pt(I,B,C,R,l,E,_),a.moveTo(y.cx+y.x01,y.cy+y.y01),E<j?a.arc(y.cx,y.cy,E,Math.atan2(y.y01,y.x01),Math.atan2(v.y01,v.x01),!_):(a.arc(y.cx,y.cy,E,Math.atan2(y.y01,y.x01),Math.atan2(y.y11,y.x11),!_),a.arc(0,0,l,Math.atan2(y.cy+y.y11,y.cx+y.x11),Math.atan2(v.cy+v.y11,v.cx+v.x11),!_),a.arc(v.cx,v.cy,E,Math.atan2(v.y11,v.x11),Math.atan2(v.y01,v.x01),!_))):(a.moveTo(A,P),a.arc(0,0,l,g,x,!_)):a.moveTo(A,P),u>wt&&w>wt?T>wt?(y=Pt(C,R,I,B,u,-T,_),v=Pt(A,P,L,q,u,-T,_),a.lineTo(y.cx+y.x01,y.cy+y.y01),T<j?a.arc(y.cx,y.cy,T,Math.atan2(y.y01,y.x01),Math.atan2(v.y01,v.x01),!_):(a.arc(y.cx,y.cy,T,Math.atan2(y.y01,y.x01),Math.atan2(y.y11,y.x11),!_),a.arc(0,0,u,Math.atan2(y.cy+y.y11,y.cx+y.x11),Math.atan2(v.cy+v.y11,v.cx+v.x11),_),a.arc(v.cx,v.cy,T,Math.atan2(v.y11,v.x11),Math.atan2(v.y01,v.x01),!_))):a.arc(0,0,u,b,m,_):a.lineTo(C,R)}else a.moveTo(0,0);if(a.closePath(),c)return a=null,c+""||null}return c.centroid=function(){var e=(+t.apply(this,arguments)+ +n.apply(this,arguments))/2,i=(+o.apply(this,arguments)+ +r.apply(this,arguments))/2-Mt/2;return[Math.cos(i)*e,Math.sin(i)*e]},c.innerRadius=function(n){return arguments.length?(t="function"==typeof n?n:bt(+n),c):t},c.outerRadius=function(t){return arguments.length?(n="function"==typeof t?t:bt(+t),c):n},c.cornerRadius=function(t){return arguments.length?(e="function"==typeof t?t:bt(+t),c):e},c.padRadius=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:bt(+t),c):i},c.startAngle=function(t){return arguments.length?(o="function"==typeof t?t:bt(+t),c):o},c.endAngle=function(t){return arguments.length?(r="function"==typeof t?t:bt(+t),c):r},c.padAngle=function(t){return arguments.length?(s="function"==typeof t?t:bt(+t),c):s},c.context=function(t){return arguments.length?(a=null==t?null:t,c):a},c}().innerRadius(n.innerRadius||0).outerRadius(n.outerRadius||n.radius||2).startAngle(n.startAngle||0).endAngle(n.endAngle||2*Math.PI);return e?(o.context(e),i.pathMethods=lineGen):i.attrs={d:o()},i},Nn=function(t){var n=t.type,e=t.subjectType,i=n.annotation,o=i.position,r=i.x-o.x,s=r+i.dx,a=i.y-o.y,c=a+i.dy,h=i.subject;if("circle"===e&&(h.outerRadius||h.radius)){var u=Math.sqrt((r-s)*(r-s)+(a-c)*(a-c)),l=Math.asin(-c/u),f=h.outerRadius||h.radius+(h.radiusPadding||0);r=Math.abs(Math.cos(l)*f)*(s<0?-1:1),a=Math.abs(Math.sin(l)*f)*(c<0?-1:1)}if("rect"===e){var p=h.width,d=h.height;(p>0&&i.dx>0||p<0&&i.dx<0)&&(r=Math.abs(p)>Math.abs(i.dx)?p/2:p),(d>0&&i.dy>0||d<0&&i.dy<0)&&(a=Math.abs(d)>Math.abs(i.dy)?d/2:d),r===p/2&&a===d/2&&(r=s,a=c)}return[[r,a],[s,c]]},On=function(t){var n=t.type,e=t.connectorData,i=t.subjectType;e||(e={}),e.points&&"number"!=typeof e.points||(e.points=An(n.annotation.offset,e.points)),e.curve||(e.curve=Kt);var o=[];if(n.editMode){var r=e.points.map(function(t,n){return vn({},function(t){var n=t.cx,e=void 0===n?0:n,i=t.cy;return{move:{x:e,y:void 0===i?0:i}}}({cx:t[0],cy:t[1]}),{index:n})});o=n.mapHandles(r.map(function(t){return vn({},t.move,{drag:function(t){e.points[t][0]+=g.dx,e.points[t][1]+=g.dy,n.redrawConnector()}.bind(n,t.index)})}))}var s=Nn({type:n,subjectType:i});return s=[s[0]].concat(function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}(e.points),[s[1]]),{components:[Tn({data:s,curve:e.curve,className:"connector"})],handles:o}},An=function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,e=t.x/(n+1),i=t.y/(n+1),o=[],r=1;r<=n;r++)o.push([e*r+r%2*20,i*r-r%2*20]);return o},Pn=function(t){var n=t.subjectData,e=t.type;n.radius||n.outerRadius||(n.radius=20);var i=[],o=En({data:n,className:"subject"});if(e.editMode){var r=function(t){var n=t.cx,e=void 0===n?0:n,i=t.cy,o=void 0===i?0:i,r=t.r1,s=t.r2,a=t.padding,c={move:{x:e,y:o}};return void 0!==r&&(c.r1={x:e+r/Math.sqrt(2),y:o+r/Math.sqrt(2)}),void 0!==s&&(c.r2={x:e+s/Math.sqrt(2),y:o+s/Math.sqrt(2)}),void 0!==a&&(c.padding={x:e+r+a,y:o}),c}({r1:o.data.outerRadius||o.data.radius,r2:o.data.innerRadius,padding:n.radiusPadding}),s=function(t){var i=n[t]+g.dx*Math.sqrt(2);n[t]=i,e.redrawSubject(),e.redrawConnector()},a=[vn({},r.r1,{drag:s.bind(e,void 0!==n.outerRadius?"outerRadius":"radius")})];n.innerRadius&&a.push(vn({},r.r2,{drag:s.bind(e,"innerRadius")})),i=e.mapHandles(a)}return o.attrs["fill-opacity"]=0,{components:[o],handles:i}},Cn=function(){function t(n){var e=n.a,i=n.annotation,o=n.editMode,r=n.dispatcher,s=n.notePadding,a=n.accessors;if(_n(this,t),this.a=e,this.note=-1===i.disable.indexOf("note")&&e.select("g.annotation-note"),this.noteContent=this.note&&e.select("g.annotation-note-content"),this.connector=-1===i.disable.indexOf("connector")&&e.select("g.annotation-connector"),this.subject=-1===i.disable.indexOf("subject")&&e.select("g.annotation-subject"),this.dispatcher=r,r){var c=zn.bind(null,r,i);c({component:this.note,name:"note"}),c({component:this.connector,name:"connector"}),c({component:this.subject,name:"subject"})}this.annotation=i,this.editMode=i.editMode||o,this.notePadding=void 0!==s?s:3,this.offsetCornerX=0,this.offsetCornerY=0,a&&i.data&&this.init(a)}return yn(t,[{key:"init",value:function(t){this.annotation.x||this.mapX(t),this.annotation.y||this.mapY(t)}},{key:"mapY",value:function(t){t.y&&(this.annotation.y=t.y(this.annotation.data))}},{key:"mapX",value:function(t){t.x&&(this.annotation.x=t.x(this.annotation.data))}},{key:"updateEditMode",value:function(){this.a.selectAll("circle.handle").remove()}},{key:"drawOnSVG",value:function(t,n){var e=this;Array.isArray(n)||(n=[n]),n.filter(function(t){return t}).forEach(function(n){var i=n.type,o=n.className,r=n.attrs,s=n.handles,a=n.classID;if("handle"===i)!function(t){var n=t.group,e=t.handles,i=t.r,o=void 0===i?10:i,r=n.selectAll("circle.handle").data(e);r.enter().append("circle").attr("class","handle").attr("fill","grey").attr("fill-opacity",.1).attr("cursor","move").attr("stroke-dasharray",5).attr("stroke","grey").call(dt().container(Q("g.annotations").node()).on("start",function(t){return t.start&&t.start(t)}).on("drag",function(t){return t.drag&&t.drag(t)}).on("end",function(t){return t.end&&t.end(t)})),n.selectAll("circle.handle").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return t.r||o}).attr("class",function(t){return"handle "+(t.className||"")}),r.exit().remove()}({group:t,r:r&&r.r,handles:s});else{Hn(t,[e.annotation],i,o,a);for(var c=t.select(i+"."+(a||o)),h=Object.keys(r),u=[],l=c.node().attributes,f=l.length-1;f>=0;f--){var p=l[f].name;-1===h.indexOf(p)&&"class"!==p&&u.push(p)}h.forEach(function(t){"text"===t?c.text(r[t]):c.attr(t,r[t])}),u.forEach(function(t){return c.attr(t,null)})}})}},{key:"getNoteBBox",value:function(){return Wn(this.note,".annotation-note-content text")}},{key:"getNoteBBoxOffset",value:function(){var t=Wn(this.note,".annotation-note-content"),n=this.noteContent.attr("transform").split(/\(|\,|\)/g);return t.offsetCornerX=parseFloat(n[1])+this.annotation.dx,t.offsetCornerY=parseFloat(n[2])+this.annotation.dy,t.offsetX=this.annotation.dx,t.offsetY=this.annotation.dy,t}},{key:"drawSubject",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.annotation.subject,i=n.type,o={type:this,subjectData:e},r={};"circle"===i?r=Pn(o):"rect"===i?r=function(t){var n=t.subjectData,e=t.type;n.width||(n.width=100),n.height||(n.height=100);var i=[],o=n.width,r=n.height,s=Tn({data:[[0,0],[o,0],[o,r],[0,r],[0,0]],className:"subject"});if(e.editMode){var a=[{x:o,y:r/2,drag:function(){n.width=g.x,e.redrawSubject(),e.redrawConnector()}.bind(e)},{x:o/2,y:r,drag:function(){n.height=g.y,e.redrawSubject(),e.redrawConnector()}.bind(e)}];i=e.mapHandles(a)}return s.attrs["fill-opacity"]=.1,{components:[s],handles:i}}(o):"threshold"===i?r=function(t){var n=t.subjectData,e=t.type.annotation.position,i=(void 0!==n.x1?n.x1:e.x)-e.x,o=(void 0!==n.x2?n.x2:e.x)-e.x,r=(void 0!==n.y1?n.y1:e.y)-e.y,s=(void 0!==n.y2?n.y2:e.y)-e.y;return{components:[Tn({data:[[i,r],[o,s]],className:"subject"})]}}(o):"badge"===i&&(r=function(t){var n=t.subjectData,e=void 0===n?{}:n,i=t.type,o=void 0===i?{}:i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=o.typeSettings&&o.typeSettings.subject;e.radius||(s&&s.radius?e.radius=s.radius:e.radius=14),e.x||s&&s.x&&(e.x=s.x),e.y||s&&s.y&&(e.y=s.y);var a=[],c=[],h=e.radius,u=.7*h,l=0,f=0,p=Math.sqrt(2)*h,d={xleftcorner:-h,xrightcorner:h,ytopcorner:-h,ybottomcorner:h,xleft:-p,xright:p,ytop:-p,ybottom:p};e.x&&!e.y?l=d["x"+e.x]:e.y&&!e.x?f=d["y"+e.y]:e.x&&e.y&&(l=d["x"+e.x+"corner"],f=d["y"+e.y+"corner"]);var _="translate("+l+", "+f+")",y=En({className:"subject",data:{radius:h}});y.attrs.transform=_,y.attrs.fill=r.color,y.attrs["stroke-linecap"]="round",y.attrs["stroke-width"]="3px";var v=En({className:"subject-ring",data:{outerRadius:h,innerRadius:u}});v.attrs.transform=_,v.attrs["stroke-width"]="3px",v.attrs.fill="white";var x=void 0;if(l&&f||!l&&!f)x=Tn({className:"subject-pointer",data:[[0,0],[l||0,0],[0,f||0],[0,0]]});else if(l||f){var m=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t&&t/Math.sqrt(2)/Math.sqrt(2)||n*h/Math.sqrt(2)};x=Tn({className:"subject-pointer",data:[[0,0],[m(l),m(f)],[m(l,-1),m(f,-1)],[0,0]]})}if(x&&(x.attrs.fill=r.color,x.attrs["stroke-linecap"]="round",x.attrs["stroke-width"]="3px",c.push(x)),o.editMode){var b={x:2*l,y:2*f,drag:function(){e.x=g.x<2*-h?"left":g.x>2*h?"right":void 0,e.y=g.y<2*-h?"top":g.y>2*h?"bottom":void 0,o.redrawSubject()}.bind(o)};b.x||b.y||(b.y=-h),a=o.mapHandles([b])}var w=void 0;return e.text&&(w={type:"text",className:"badge-text",attrs:{fill:"white",stroke:"none","font-size":".7em",text:e.text,"text-anchor":"middle",dy:".25em",x:l,y:f}}),c.push(y),c.push(v),c.push(w),{components:c,handles:a}}(o,this.annotation));var s=r,a=s.components,c=void 0===a?[]:a,h=s.handles,u=void 0===h?[]:h;return c.forEach(function(n){n&&n.attrs&&!n.attrs.stroke&&(n.attrs.stroke=t.annotation.color)}),this.editMode&&(u=u.concat(this.mapHandles([{drag:this.dragSubject.bind(this)}])),c.push({type:"handle",handles:u})),c}},{key:"drawConnector",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.annotation.connector,i=e.type||n.type,o={type:this,connectorData:e};o.subjectType=this.typeSettings&&this.typeSettings.subject&&this.typeSettings.subject.type;var r="curve"===i?On(o):"elbow"===i?function(t){var n=t.type,e=t.subjectType,i=n.annotation,o=i.position,r=i.x-o.x,s=r+i.dx,a=i.y-o.y,c=a+i.dy,h=i.subject;if("rect"===e){var u=h.width,l=h.height;(u>0&&i.dx>0||u<0&&i.dx<0)&&(r=Math.abs(u)>Math.abs(i.dx)?u/2:u),(l>0&&i.dy>0||l<0&&i.dy<0)&&(a=Math.abs(l)>Math.abs(i.dy)?l/2:l),r===u/2&&a===l/2&&(r=s,a=c)}var f=[[r,a],[s,c]],p=c-a,d=s-r,_=s,y=c,v=c<a&&s>r||s<r&&c>a?-1:1;if(Math.abs(d)<Math.abs(p)?(_=s,y=a+d*v):(y=c,_=r+p*v),"circle"===e&&(h.outerRadius||h.radius)){var g=(h.outerRadius||h.radius)+(h.radiusPadding||0),x=g/Math.sqrt(2);if(Math.abs(d)>x&&Math.abs(p)>x)f=[[r=x*(s<0?-1:1),a=x*(c<0?-1:1)],[_,y],[s,c]];else if(Math.abs(d)>Math.abs(p)){var m=Math.asin(-c/g);f=[[r=Math.abs(Math.cos(m)*g)*(s<0?-1:1),c],[s,c]]}else{var b=Math.acos(s/g);f=[[s,a=Math.abs(Math.sin(b)*g)*(c<0?-1:1)],[s,c]]}}else f=[[r,a],[_,y],[s,c]];return{components:[Tn({data:f,className:"connector"})]}}(o):function(t){var n=Nn(t);return{components:[Tn({data:n,className:"connector"})]}}(o),s=r.components,a=void 0===s?[]:s,c=r.handles,h=void 0===c?[]:c,u=a[0];u&&(u.attrs.stroke=this.annotation.color,u.attrs.fill="none");var l=e.end||n.end,f={};if("arrow"===l){var p=u.data[1],d=u.data[0];Math.sqrt(Math.pow(p[0]-d[0],2)+Math.pow(p[1]-d[1],2))<5&&u.data[2]&&(p=u.data[2]),f=function(t){var n=t.annotation,e=t.start,i=t.end,o=t.scale,r=void 0===o?1:o,s=n.position;e=e?[-i[0]+e[0],-i[1]+e[1]]:[n.dx,n.dy],i||(i=[n.x-s.x,n.y-s.y]);var a=i[0],c=i[1],h=e[0],u=e[1],l=10*r,f=16/180*Math.PI,p=Math.atan(u/h);h<0&&(p+=Math.PI);var d=[[a,c],[Math.cos(p+f)*l+a,Math.sin(p+f)*l+c],[Math.cos(p-f)*l+a,Math.sin(p-f)*l+c],[a,c]];return{components:[Tn({data:d,className:"connector-end connector-arrow",classID:"connector-end"})]}}({annotation:this.annotation,start:p,end:d,scale:e.endScale})}else"dot"===l?f=function(t){var n=t.line,e=t.scale,i=void 0===e?1:e,o=En({className:"connector-end connector-dot",classID:"connector-end",data:{radius:3*Math.sqrt(i)}});return o.attrs.transform="translate("+n.data[0][0]+", "+n.data[0][1]+")",{components:[o]}}({line:u,scale:e.endScale}):l&&"none"!==l||this.connector&&this.connector.select(".connector-end").remove();return f.components&&(f.components.forEach(function(n){n.attrs.fill=t.annotation.color,n.attrs.stroke=t.annotation.color}),a=a.concat(f.components)),this.editMode&&0!==h.length&&a.push({type:"handle",handles:h}),a}},{key:"drawNote",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.annotation.note,i=e.align||n.align||"dynamic",o={bbox:n.bbox,align:i,offset:this.annotation.offset},r=e.lineType||n.lineType,s={};"vertical"===r?s=function(t){var n=t.align,e=t.x,i=void 0===e?0:e,o=t.y,r=void 0===o?0:o,s=t.bbox,a=t.offset;"top"===(n=Mn(n,a.y))?r-=s.height:"middle"===n&&(r-=s.height/2);var c=[[i,r],[i,r+s.height]];return{components:[Tn({data:c,className:"note-line"})]}}(o):"horizontal"===r&&(s=function(t){var n=t.align,e=t.x,i=void 0===e?0:e,o=t.y,r=void 0===o?0:o,s=t.offset,a=t.bbox;"right"===(n=kn(n,s.x))?i-=a.width:"middle"===n&&(i-=a.width/2);var c=[[i,r],[i+a.width,r]];return{components:[Tn({data:c,className:"note-line"})]}}(o));var a=s,c=a.components,h=void 0===c?[]:c,u=a.handles,l=void 0===u?[]:u;if(h.forEach(function(n){n.attrs.stroke=t.annotation.color}),this.editMode){l=this.mapHandles([{x:0,y:0,drag:this.dragNote.bind(this)}]),h.push({type:"handle",handles:l});var f=this.dragNote.bind(this),p=this.dragstarted.bind(this),d=this.dragended.bind(this);this.note.call(dt().container(Q("g.annotations").node()).on("start",function(t){return p(t)}).on("drag",function(t){return f(t)}).on("end",function(t){return d(t)}))}else this.note.on("mousedown.drag",null);return h}},{key:"drawNoteContent",value:function(t){var n=this.annotation.note,e=void 0!==n.padding?n.padding:this.notePadding,i=n.orientation||t.orientation||"topBottom",o=n.lineType||t.lineType,r=n.align||t.align||"dynamic";"vertical"===o?i="leftRight":"horizontal"===o&&(i="topBottom");var s=function(t){var n=t.padding,e=void 0===n?0:n,i=t.bbox,o=void 0===i?{x:0,y:0,width:0,height:0}:i,r=t.align,s=t.orientation,a=t.offset,c=void 0===a?{x:0,y:0}:a,h=-o.x,u=0;return-1!==Sn.indexOf(s)?(r=kn(r,c.x),c.y<0&&"topBottom"===s||"top"===s?u-=o.height+e:u+=e,"middle"===r?h-=o.width/2:"right"===r&&(h-=o.width)):-1!==jn.indexOf(s)&&(r=Mn(r,c.y),c.x<0&&"leftRight"===s||"left"===s?h-=o.width+e:h+=e,"middle"===r?u-=o.height/2:"top"===r&&(u-=o.height)),{x:h,y:u}}({padding:e,bbox:t.bbox,offset:this.annotation.offset,orientation:i,align:r}),a=s.x,c=s.y;return this.offsetCornerX=a+this.annotation.dx,this.offsetCornerY=c+this.annotation.dy,this.note&&this.noteContent.attr("transform","translate("+a+", "+c+")"),[]}},{key:"drawOnScreen",value:function(t,n){return this.drawOnSVG(t,n)}},{key:"redrawSubject",value:function(){this.subject&&this.drawOnScreen(this.subject,this.drawSubject())}},{key:"redrawConnector",value:function(){this.connector&&this.drawOnScreen(this.connector,this.drawConnector())}},{key:"redrawNote",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getNoteBBox();this.noteContent&&this.drawOnScreen(this.noteContent,this.drawNoteContent({bbox:t})),this.note&&this.drawOnScreen(this.note,this.drawNote({bbox:t}))}},{key:"setPosition",value:function(){var t=this.annotation.position;this.a.attr("transform","translate("+t.x+", "+t.y+")")}},{key:"clearComponents",value:function(){this.subject&&this.subject.select("*").remove(),this.connector&&this.connector.select("*").remove()}},{key:"setOffset",value:function(){if(this.note){var t=this.annotation.offset;this.note.attr("transform","translate("+t.x+", "+t.y+")")}}},{key:"setPositionWithAccessors",value:function(t){t&&this.annotation.data&&(this.mapX(t),this.mapY(t)),this.setPosition()}},{key:"setClassName",value:function(){this.a.attr("class","annotation "+(this.className&&this.className())+" "+(this.editMode?"editable":"")+" "+(this.annotation.className||""))}},{key:"draw",value:function(){this.setClassName(),this.setPosition(),this.setOffset(),this.redrawSubject(),this.redrawConnector(),this.redrawNote()}},{key:"dragstarted",value:function(){g.sourceEvent.stopPropagation(),this.dispatcher&&this.dispatcher.call("dragstart",this.a,this.annotation),this.a.classed("dragging",!0),this.a.selectAll("circle.handle").style("pointer-events","none")}},{key:"dragended",value:function(){this.dispatcher&&this.dispatcher.call("dragend",this.a,this.annotation),this.a.classed("dragging",!1),this.a.selectAll("circle.handle").style("pointer-events","all")}},{key:"dragSubject",value:function(){var t=this.annotation.position;t.x+=g.dx,t.y+=g.dy,this.annotation.position=t}},{key:"dragNote",value:function(){var t=this.annotation.offset;t.x+=g.dx,t.y+=g.dy,this.annotation.offset=t}},{key:"mapHandles",value:function(t){var n=this;return t.map(function(t){return vn({},t,{start:n.dragstarted.bind(n),end:n.dragended.bind(n)})})}}]),t}(),Rn=function(t,n,e){return function(i){function o(t){_n(this,o);var e=mn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.typeSettings=n,n.disable&&n.disable.forEach(function(t){e[t]&&e[t].remove(),e[t]=void 0,"note"===t&&(e.noteContent=void 0)}),e}return xn(o,t),yn(o,[{key:"className",value:function(){return""+(n.className||gn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"className",this)&&gn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"className",this).call(this)||"")}},{key:"drawSubject",value:function(t){return this.typeSettings.subject=vn({},n.subject,this.typeSettings.subject),gn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawSubject",this).call(this,vn({},t,this.typeSettings.subject))}},{key:"drawConnector",value:function(t){return this.typeSettings.connector=vn({},n.connector,this.typeSettings.connector),gn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawConnector",this).call(this,vn({},t,n.connector,this.typeSettings.connector))}},{key:"drawNote",value:function(t){return this.typeSettings.note=vn({},n.note,this.typeSettings.note),gn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawNote",this).call(this,vn({},t,n.note,this.typeSettings.note))}},{key:"drawNoteContent",value:function(t){return gn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawNoteContent",this).call(this,vn({},t,n.note,this.typeSettings.note))}}],[{key:"init",value:function(t,n){return gn(o.__proto__||Object.getPrototypeOf(o),"init",this).call(this,t,n),e&&(t=e(t,n)),t}}]),o}()},In=function(t){function n(t){_n(this,n);var e=mn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.textWrap=t.textWrap||120,e.drawText(),e}return xn(n,Cn),yn(n,[{key:"updateTextWrap",value:function(t){this.textWrap=t,this.drawText()}},{key:"drawText",value:function(){if(this.note){Hn(this.note,[this.annotation],"g","annotation-note-content");var t=this.note.select("g.annotation-note-content");Hn(t,[this.annotation],"rect","annotation-note-bg"),Hn(t,[this.annotation],"text","annotation-note-label"),Hn(t,[this.annotation],"text","annotation-note-title");var n={height:0},e=this.a.select("text.annotation-note-label"),i=this.annotation.note&&this.annotation.note.wrap||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrap||this.textWrap,o=this.annotation.note&&this.annotation.note.wrapSplitter||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrapSplitter,r=this.annotation.note&&this.annotation.note.bgPadding||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.bgPadding,s={top:0,bottom:0,left:0,right:0};if("number"==typeof r?s={top:r,bottom:r,left:r,right:r}:r&&"object"===(void 0===r?"undefined":dn(r))&&(s=vn(s,r)),this.annotation.note.title){var a=this.a.select("text.annotation-note-title");a.text(this.annotation.note.title),a.attr("fill",this.annotation.color),a.attr("font-weight","bold"),a.call(Dn,i,o),n=a.node().getBBox()}e.text(this.annotation.note.label).attr("dx","0"),e.call(Dn,i,o),e.attr("y",1.1*n.height||0),e.attr("fill",this.annotation.color);var c=this.getNoteBBox();this.a.select("rect.annotation-note-bg").attr("width",c.width+s.left+s.right).attr("height",c.height+s.top+s.bottom).attr("x",c.x-s.left).attr("y",-s.top).attr("fill","white").attr("fill-opacity",0)}}}]),n}(),Bn=(Rn(In,{className:"label",note:{align:"middle"}}),Rn(In,{className:"callout",note:{lineType:"horizontal"}})),Ln=(Rn(Bn,{className:"callout elbow",connector:{type:"elbow"}}),Rn(Bn,{className:"callout curve",connector:{type:"curve"}})),qn=(Rn(Cn,{className:"badge",subject:{type:"badge"},disable:["connector","note"]}),Rn(In,{className:"callout circle",subject:{type:"circle"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),Rn(In,{className:"callout rect",subject:{type:"rect"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),function(t){function n(){return _n(this,n),mn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return xn(n,Bn),yn(n,[{key:"mapY",value:function(t){gn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"mapY",this).call(this,t);var e=this.annotation;(e.subject.x1||e.subject.x2)&&e.data&&t.y&&(e.y=t.y(e.data)),!e.subject.x1&&!e.subject.x2||e.x||(e.x=e.subject.x1||e.subject.x2)}},{key:"mapX",value:function(t){gn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"mapX",this).call(this,t);var e=this.annotation;(e.subject.y1||e.subject.y2)&&e.data&&t.x&&(e.x=t.x(e.data)),!e.subject.y1&&!e.subject.y2||e.y||(e.y=e.subject.y1||e.subject.y2)}}]),n}()),Hn=(Rn(qn,{className:"callout xythreshold",subject:{type:"threshold"}}),function(t,n,e,i,o){var r=t.selectAll(e+"."+(o||i)).data(n);return r.enter().append(e).merge(r).attr("class",i),r.exit().remove(),t}),zn=function(t,n,e){var i=e.component,o=e.name;i&&i.on("mouseover.annotations",function(){t.call(o+"over",i,n)}).on("mouseout.annotations",function(){return t.call(o+"out",i,n)}).on("click.annotations",function(){return t.call(o+"click",i,n)})},Dn=function(t,n,e){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.2;t.each(function(){for(var t=Q(this),o=t.text().split(e||/[ \t\r\n]+/).reverse().filter(function(t){return""!==t}),r=void 0,s=[],a=t.text(null).append("tspan").attr("x",0).attr("dy","0.8em");r=o.pop();)s.push(r),a.text(s.join(" ")),a.node().getComputedTextLength()>n&&s.length>1&&(s.pop(),a.text(s.join(" ")),s=[r],a=t.append("tspan").attr("x",0).attr("dy",i+"em").text(r))})},Wn=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":not(.handle)";return t?t.selectAll(n).nodes().reduce(function(t,n){var e=n.getBBox();t.x=Math.min(t.x,e.x),t.y=Math.min(t.y,e.y),t.width=Math.max(t.width,e.width);var i=n&&n.attributes&&n.attributes.y;return t.height=Math.max(t.height,(i&&parseFloat(i.value)||0)+e.height),t},{x:0,y:0,width:0,height:0}):{x:0,y:0,width:0,height:0}};function Yn(){var t=[],n=void 0,e=void 0,i=[],o={},r={},s=!1,a=void 0,c=Bn,h=void 0,u=void 0,l=rt("subjectover","subjectout","subjectclick","connectorover","connectorout","connectorclick","noteover","noteout","noteclick","dragend","dragstart"),f=void 0,p=function(e){f=e,s||e.selectAll("circle.handle").remove();var p=t.map(function(t){return t.type||(t.type=c),t.disable||(t.disable=i),new bn(t)});n=n||new wn({annotations:p,accessors:o,accessorsInverse:r,ids:a}),e.selectAll("g").data([n]).enter().append("g").attr("class","annotations");var d=e.select("g.annotations");Hn(d,n.annotations,"g","annotation");var _=d.selectAll("g.annotation");_.each(function(t){var n=Q(this);n.attr("class","annotation"),Hn(n,[t],"g","annotation-connector"),Hn(n,[t],"g","annotation-subject"),Hn(n,[t],"g","annotation-note"),Hn(n.select("g.annotation-note"),[t],"g","annotation-note-content"),t.type="[object Object]"===t.type.toString()?t.type:new t.type({a:n,annotation:t,textWrap:h,notePadding:u,editMode:s,dispatcher:l,accessors:o}),t.type.draw(),t.type.drawText&&t.type.drawText()})};return p.json=function(){return console.log("Annotations JSON was copied to your clipboard. Please note the annotation type is not JSON compatible. It appears in the objects array in the console, but not in the copied JSON.",n.json),window.copy(JSON.stringify(n.json.map(function(t){return delete t.type,t}))),p},p.update=function(){return t&&n&&(t=n.annotations.map(function(t){return t.type.draw(),t})),p},p.updateText=function(){return n&&(n.updateText(h),t=n.annotations),p},p.updatedAccessors=function(){return n.setPositionWithAccessors(),t=n.annotations,p},p.disable=function(e){return arguments.length?(i=e,n&&(n.updateDisable(i),t=n.annotations),p):i},p.textWrap=function(e){return arguments.length?(h=e,n&&(n.updateTextWrap(h),t=n.annotations),p):h},p.notePadding=function(e){return arguments.length?(u=e,n&&(n.updateNotePadding(u),t=n.annotations),p):u},p.type=function(e,i){return arguments.length?(c=e,n&&(n.annotations.map(function(t){t.type.note&&t.type.note.selectAll("*:not(.annotation-note-content)").remove(),t.type.noteContent&&t.type.noteContent.selectAll("*").remove(),t.type.subject&&t.type.subject.selectAll("*").remove(),t.type.connector&&t.type.connector.selectAll("*").remove(),t.type.typeSettings={},t.type=c,t.subject=i&&i.subject||t.subject,t.connector=i&&i.connector||t.connector,t.note=i&&i.note||t.note}),t=n.annotations),p):c},p.annotations=function(e){if(!arguments.length)return n&&n.annotations||t;(t=e,n&&n.annotations)&&(t.some(function(t){return!t.type||"[object Object]"!==t.type.toString()})?(n=null,p(f)):n.annotations=t);return p},p.context=function(t){return arguments.length?(e=t,p):e},p.accessors=function(t){return arguments.length?(o=t,p):o},p.accessorsInverse=function(t){return arguments.length?(r=t,p):r},p.ids=function(t){return arguments.length?(a=t,p):a},p.editMode=function(e){return arguments.length?(s=e,f&&f.selectAll("g.annotation").classed("editable",s),n&&(n.editMode(s),t=n.annotations),p):s},p.collection=function(t){return arguments.length?(n=t,p):n},p.on=function(){var t=l.on.apply(l,arguments);return t===l?p:t},p}var Fn=e(3),Xn=e.n(Fn),Vn=e(4),Jn=e.n(Vn);var Un=function(t){var n=t.text,e=t.chars,i=void 0===e?100:e,o=t.clean,r=void 0===o||o,s=t.ellipses,a=void 0!==s&&s,c=n.length>i,h=n.substring(0,i),u=r?h.lastIndexOf(" "):h.length,l=c?h.substring(0,u):n,f=c&&a?"...":"";return"".concat(l).concat(f)};function Gn(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=[],i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(e.push(s.value),!n||e.length!==n);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return e}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function $n(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{},i=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.forEach(function(n){Zn(t,n,e[n])})}return t}function Zn(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function Qn(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Kn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],te=4/3,ne=320,ee=16,ie=[],oe=[],re=[],se=d3.select("#timeline"),ae=se.select(".figure__chart"),ce=se.select(".figure__annotation"),he=se.select(".timeline__headline"),ue=he.select("h3"),le=he.select("ul"),fe=se.select(".timeline__toggle"),pe=0,de=0,_e=0,ye=0,ve=0,ge=Jn()();function xe(t){var n=ae.selectAll(".year").filter(function(n,e){return e===t}).datum();ue.text("Headlines from ".concat(n.key)),le.selectAll("li").remove();var e=n.values;e.sort(function(t,n){return d3.descending(t.count,n.count)});var i=e.slice(0,3).map(function(t){return{month:Kn[+t.month-1],headline:function(t){var n=re.find(function(n){return n.month===t.month&&n.year===t.year});if(!n)return"N/A";var e=n.headline,i=n.common,o=n.demonym,r=n.city,s=Un({text:e,chars:ve,clean:!0,ellipses:!0}),a=Qn(i.split(":")).concat(Qn(o.split(":")),Qn(r.split(":"))).find(function(n){return n.includes(t.country[0])});if(!a)return"N/A";var c=a.split("(")[1].replace(")",""),h=e.toLowerCase().indexOf(c),u=h+c.length,l=s.substring(0,h),f=s.substring(h,u),p=s.substring(u,s.length);return"".concat(l,"<strong>").concat(f,"</strong>").concat(p)}(t)}}).filter(function(t){return t.headline}),o=le.selectAll("li").data(i).enter().append("li");o.append("span.month").text(function(t){return t.month}),o.append("span.headline").html(function(t){return t.headline})}function me(t){var n=t.progress,e=Math.min(ye-1,Math.floor(n*ye));ae.selectAll(".year").classed("is-focus",function(t,n){return n===e}),xe(e)}function be(){ae.select(".timeline__headline").classed("is-visible",!0)}function we(){ae.select(".timeline__headline").classed("is-visible",!1)}function Me(t){var n=t.data;d3.select(this).parent().parent().parent().select(".annotation-connector").st("opacity",1),console.log(n.year,n.month),ae.select('[data-id="'.concat(n.year,"-").concat(n.month,'"]')).classed("is-focus",!0)}function ke(t){var n=t.data;d3.select(this).parent().parent().parent().select(".annotation-connector").st("opacity",0),ae.select('[data-id="'.concat(n.year,"-").concat(n.month,'"]')).classed("is-focus",!1)}function Se(){var t=he.classed("is-show");he.classed("is-show",!t),fe.text(t?"Show headlines":"Hide headlines")}function je(){ve=Math.floor(.3*window.innerHeight);var t=se.select(".year");if(t.size()){var n=se.node().offsetWidth,e=t.node().offsetWidth,i=n<70*ee,o=(n-e)/2,r=i?n-5*ee:n-o;ce.st("width",r).st("left",i?5*ee:o),de=(pe=e/12)/te,se.selectAll("li").st("height",de),se.selectAll(".flag").st({width:pe,height:de}),se.selectAll(".title").st("line-height",de);var s=Math.min(o-1.25*pe,480),a=Math.max(0,o-s-5*ee),c=window.innerHeight-(i?3:5)*ee;he.st("width",i?280:s).st("left",i?0:a).st("height",c),Math.floor(c/12),ae.st("margin-top",i?0:-c),_e=Math.min(i?1.6*o:.8*o,ne),function(t){ce.select(".g-annotation").remove();var n=ce.append("g.g-annotation"),e=Rn(Ln,{className:"custom",connector:{type:"curve",end:"arrow"},note:{lineType:"horizontal",align:"left"}}),i=t.map(function(t){return{note:{title:t.year,label:t.label,padding:0,wrap:_e,bgPadding:{top:5,left:5,right:5,bottom:5}},data:{year:t.year,yearOff:+t.year-1900,month:t.month},dx:(12-+t.month)*pe+pe,dy:3*de,connector:{points:1}}}),o=Yn().type(e).accessors({x:function(t){return t.month*pe-pe/2},y:function(t){return t.yearOff*de+de/2+t.yearOff/2}}).annotations(i);n.call(o),n.selectAll(".annotation-note-bg").on("mouseenter",Me).on("mouseout",ke)}([{year:"1907",month:"06",label:d3.range(100).map(function(){return"m"}).join(" ")}])}ge.resize()}function Te(t){var n=d3.select(this);"1900"===t.year&&n.append("span.month").text(function(t){return Kn[+t.month-1]});var e=n.selectAll(".country").data(function(t){return t.country}).enter().append("div.country").classed("is-uk",function(t){return"united kingdom"===t});e.append("span.flag").html(function(t){var n=(ie.find(function(n){return n.commonLower===t})||{cca2:"none"}).cca2;return'<img src="assets/flags/jpg-4x3-192-q70/'.concat(n.toLowerCase(),'.jpg">')}),e.append("span.name").text(function(t){var n=ie.find(function(n){return n.commonLower===t});return n?n.common:t}),t.country.length>1&&n.append("span.layer").text("+".concat(t.country.length-1))}function Ee(){d3.loadData("assets/data/headlines.csv",function(t,n){t&&console.log(t),re=n[0],me({progress:0})})}function Ne(){return new Promise(function(t){d3.loadData("assets/data/result--month.csv",function(n,e){n&&console.log(n),oe=function(t){var n,e=t.map(function(t){return $n({},t,{count:+t.count,country:t.country.split(":")})}),i=Gn(d3.extent(e,function(t){return+t.year}),2),o=i[0],r=i[1],s=d3.range(o,r+1).map(function(t){return d3.range(Kn.length).map(function(n){return{year:t,month:n+1}})});return(n=[]).concat.apply(n,Qn(s)).map(function(t){var n=e.find(function(n){return+n.year===t.year&&+n.month===t.month});return n&&n.count<5&&(n.country=["N/A"]),n||{year:t.year.toString(),month:d3.format("02")(t.month),country:["N/A"],count:0}})}(e[0].filter(function(t){return+t.year})),function(){var t=d3.nest().key(function(t){return t.year}).entries(oe),n=ae.selectAll(".year").data(t).enter().append("div.year");n.append("h3.title").text(function(t){return t.key});var e=n.append("ul").selectAll("li").data(function(t){return t.values}).enter().append("li").at("data-id",function(t){return"".concat(t.year,"-").concat(t.month)});ye=n.size(),e.each(Te)}(),ge.setup({step:"figure",progress:!0}).onStepEnter(be).onStepExit(we).onStepProgress(me),ge.resize(),fe.on("click",Se),me({progress:0}),je(),t()})})}var Oe={init:function(){var t;Xn.a.add(d3.selectAll(".sticky").nodes());var n=["countries.csv"].map(function(t){return"assets/data/".concat(t)});(t=d3).loadData.apply(t,Qn(n).concat([function(t,n){t&&console.log(t),ie=function(t){return t.map(function(t){return $n({},t,{ccn3:+t.ccn3,lat:+t.latlng.split(",")[0].trim(),commonLower:t.common.toLowerCase(),lng:+t.latlng.split(",")[1].trim()})})}(n[0]),Ne().then(Ee)}]))},resize:je},Ae=d3.select("body"),Pe=0;function Ce(){var t=Ae.node().offsetWidth;Pe!==t&&(Pe=t,Oe.resize())}Ae.classed("is-mobile",s.any()),window.addEventListener("resize",o()(Ce,150)),function(){if(Ae.select("header").classed("is-sticky")){var t=Ae.select(".header__menu"),n=Ae.select(".header__toggle");n.on("click",function(){var e=t.classed("is-visible");t.classed("is-visible",!e),n.classed("is-visible",!e)})}}(),Oe.init()},2:function(t,n,e){(function(n){var e="Expected a function",i=NaN,o="[object Symbol]",r=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,h=parseInt,u="object"==typeof n&&n&&n.Object===Object&&n,l="object"==typeof self&&self&&self.Object===Object&&self,f=u||l||Function("return this")(),p=Object.prototype.toString,d=Math.max,_=Math.min,y=function(){return f.Date.now()};function v(t){var n=typeof t;return!!t&&("object"==n||"function"==n)}function g(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&p.call(t)==o}(t))return i;if(v(t)){var n="function"==typeof t.valueOf?t.valueOf():t;t=v(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(r,"");var e=a.test(t);return e||c.test(t)?h(t.slice(2),e?2:8):s.test(t)?i:+t}t.exports=function(t,n,i){var o,r,s,a,c,h,u=0,l=!1,f=!1,p=!0;if("function"!=typeof t)throw new TypeError(e);function x(n){var e=o,i=r;return o=r=void 0,u=n,a=t.apply(i,e)}function m(t){var e=t-h;return void 0===h||e>=n||e<0||f&&t-u>=s}function b(){var t=y();if(m(t))return w(t);c=setTimeout(b,function(t){var e=n-(t-h);return f?_(e,s-(t-u)):e}(t))}function w(t){return c=void 0,p&&o?x(t):(o=r=void 0,a)}function M(){var t=y(),e=m(t);if(o=arguments,r=this,h=t,e){if(void 0===c)return function(t){return u=t,c=setTimeout(b,n),l?x(t):a}(h);if(f)return c=setTimeout(b,n),x(h)}return void 0===c&&(c=setTimeout(b,n)),a}return n=g(n)||0,v(i)&&(l=!!i.leading,s=(f="maxWait"in i)?d(g(i.maxWait)||0,n):s,p="trailing"in i?!!i.trailing:p),M.cancel=function(){void 0!==c&&clearTimeout(c),u=0,o=h=r=c=void 0},M.flush=function(){return void 0===c?a:w(y())},M}}).call(this,e(0))},3:function(t,n,e){!function(n,e){"use strict";var i=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}();var o=!1,r=void 0!==n;r&&n.getComputedStyle?function(){var t=e.createElement("div");["","-webkit-","-moz-","-ms-"].some(function(n){try{t.style.position=n+"sticky"}catch(t){}return""!=t.style.position})&&(o=!0)}():o=!0;var s=!1,a="undefined"!=typeof ShadowRoot,c={top:null,left:null},h=[];function u(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])}function l(t){return parseFloat(t)||0}function f(t){for(var n=0;t;)n+=t.offsetTop,t=t.offsetParent;return n}var p=function(){function t(n){if(function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),!(n instanceof HTMLElement))throw new Error("First argument must be HTMLElement");if(h.some(function(t){return t._node===n}))throw new Error("Stickyfill is already applied to this node");this._node=n,this._stickyMode=null,this._active=!1,h.push(this),this.refresh()}return i(t,[{key:"refresh",value:function(){if(!o&&!this._removed){this._active&&this._deactivate();var t=this._node,i=getComputedStyle(t),r={position:i.position,top:i.top,display:i.display,marginTop:i.marginTop,marginBottom:i.marginBottom,marginLeft:i.marginLeft,marginRight:i.marginRight,cssFloat:i.cssFloat};if(!isNaN(parseFloat(r.top))&&"table-cell"!=r.display&&"none"!=r.display){this._active=!0;var s=t.style.position;"sticky"!=i.position&&"-webkit-sticky"!=i.position||(t.style.position="static");var c=t.parentNode,h=a&&c instanceof ShadowRoot?c.host:c,p=t.getBoundingClientRect(),d=h.getBoundingClientRect(),_=getComputedStyle(h);this._parent={node:h,styles:{position:h.style.position},offsetHeight:h.offsetHeight},this._offsetToWindow={left:p.left,right:e.documentElement.clientWidth-p.right},this._offsetToParent={top:p.top-d.top-l(_.borderTopWidth),left:p.left-d.left-l(_.borderLeftWidth),right:-p.right+d.right-l(_.borderRightWidth)},this._styles={position:s,top:t.style.top,bottom:t.style.bottom,left:t.style.left,right:t.style.right,width:t.style.width,marginTop:t.style.marginTop,marginLeft:t.style.marginLeft,marginRight:t.style.marginRight};var y=l(r.top);this._limits={start:p.top+n.pageYOffset-y,end:d.top+n.pageYOffset+h.offsetHeight-l(_.borderBottomWidth)-t.offsetHeight-y-l(r.marginBottom)};var v=_.position;"absolute"!=v&&"relative"!=v&&(h.style.position="relative"),this._recalcPosition();var g=this._clone={};g.node=e.createElement("div"),u(g.node.style,{width:p.right-p.left+"px",height:p.bottom-p.top+"px",marginTop:r.marginTop,marginBottom:r.marginBottom,marginLeft:r.marginLeft,marginRight:r.marginRight,cssFloat:r.cssFloat,padding:0,border:0,borderSpacing:0,fontSize:"1em",position:"static"}),c.insertBefore(g.node,t),g.docOffsetTop=f(g.node)}}}},{key:"_recalcPosition",value:function(){if(this._active&&!this._removed){var t=c.top<=this._limits.start?"start":c.top>=this._limits.end?"end":"middle";if(this._stickyMode!=t){switch(t){case"start":u(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:this._offsetToParent.top+"px",bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"middle":u(this._node.style,{position:"fixed",left:this._offsetToWindow.left+"px",right:this._offsetToWindow.right+"px",top:this._styles.top,bottom:"auto",width:"auto",marginLeft:0,marginRight:0,marginTop:0});break;case"end":u(this._node.style,{position:"absolute",left:this._offsetToParent.left+"px",right:this._offsetToParent.right+"px",top:"auto",bottom:0,width:"auto",marginLeft:0,marginRight:0})}this._stickyMode=t}}}},{key:"_fastCheck",value:function(){this._active&&!this._removed&&(Math.abs(f(this._clone.node)-this._clone.docOffsetTop)>1||Math.abs(this._parent.node.offsetHeight-this._parent.offsetHeight)>1)&&this.refresh()}},{key:"_deactivate",value:function(){var t=this;this._active&&!this._removed&&(this._clone.node.parentNode.removeChild(this._clone.node),delete this._clone,u(this._node.style,this._styles),delete this._styles,h.some(function(n){return n!==t&&n._parent&&n._parent.node===t._parent.node})||u(this._parent.node.style,this._parent.styles),delete this._parent,this._stickyMode=null,this._active=!1,delete this._offsetToWindow,delete this._offsetToParent,delete this._limits)}},{key:"remove",value:function(){var t=this;this._deactivate(),h.some(function(n,e){if(n._node===t._node)return h.splice(e,1),!0}),this._removed=!0}}]),t}(),d={stickies:h,Sticky:p,forceSticky:function(){o=!1,_(),this.refreshAll()},addOne:function(t){if(!(t instanceof HTMLElement)){if(!t.length||!t[0])return;t=t[0]}for(var n=0;n<h.length;n++)if(h[n]._node===t)return h[n];return new p(t)},add:function(t){if(t instanceof HTMLElement&&(t=[t]),t.length){for(var n=[],e=function(e){var i=t[e];return i instanceof HTMLElement?h.some(function(t){if(t._node===i)return n.push(t),!0})?"continue":void n.push(new p(i)):(n.push(void 0),"continue")},i=0;i<t.length;i++)e(i);return n}},refreshAll:function(){h.forEach(function(t){return t.refresh()})},removeOne:function(t){if(!(t instanceof HTMLElement)){if(!t.length||!t[0])return;t=t[0]}h.some(function(n){if(n._node===t)return n.remove(),!0})},remove:function(t){if(t instanceof HTMLElement&&(t=[t]),t.length)for(var n=function(n){var e=t[n];h.some(function(t){if(t._node===e)return t.remove(),!0})},e=0;e<t.length;e++)n(e)},removeAll:function(){for(;h.length;)h[0].remove()}};function _(){if(!s){s=!0,r(),n.addEventListener("scroll",r),n.addEventListener("resize",d.refreshAll),n.addEventListener("orientationchange",d.refreshAll);var t=void 0,i=void 0,o=void 0;"hidden"in e?(i="hidden",o="visibilitychange"):"webkitHidden"in e&&(i="webkitHidden",o="webkitvisibilitychange"),o?(e[i]||a(),e.addEventListener(o,function(){e[i]?clearInterval(t):a()})):a()}function r(){n.pageXOffset!=c.left?(c.top=n.pageYOffset,c.left=n.pageXOffset,d.refreshAll()):n.pageYOffset!=c.top&&(c.top=n.pageYOffset,c.left=n.pageXOffset,h.forEach(function(t){return t._recalcPosition()}))}function a(){t=setInterval(function(){h.forEach(function(t){return t._fastCheck()})},500)}}o||_(),t.exports?t.exports=d:r&&(n.Stickyfill=d)}(window,document)},4:function(t,n,e){t.exports=function(){"use strict";function t(t){for(var n=t.length,e=[],i=0;i<n;i+=1)e.push(t[i]);return e}function n(t){return t instanceof Element?t:"string"==typeof t?document.querySelector(t):null}function e(t){var n=t.id;return"scrollama__debug-offset--"+n}function i(t){var n=t.id,i=t.offsetVal,o=t.stepEl,r=o[0].getAttribute("class");!function(t){var n=t.id,i=t.offsetVal,o=t.stepClass,r=document.createElement("div");r.setAttribute("id",e({id:n})),r.setAttribute("class","scrollama__debug-offset"),r.style.position="fixed",r.style.left="0",r.style.width="100%",r.style.height="0px",r.style.borderTop="2px dashed black",r.style.zIndex="9999";var s=document.createElement("p");s.innerText='".'+o+'" trigger: '+i,s.style.fontSize="12px",s.style.fontFamily="monospace",s.style.color="black",s.style.margin="0",s.style.padding="6px",r.appendChild(s),document.body.appendChild(r)}({id:n,offsetVal:i,stepClass:r})}function o(t){var n=t.id,i=(t.stepOffsetHeight,t.offsetMargin);t.offsetVal,function(t){var n=t.id,i=t.offsetMargin,o=(t.offsetVal,e({id:n}));document.querySelector("#"+o).style.top=i+"px"}({id:n,offsetMargin:i})}function r(t){var n=t.id,e=t.index,i=t.state,o=function(t){var n=t.id,e=t.i;return"scrollama__debug-step--"+n+"-"+e}({id:n,i:e}),r=document.querySelector("#"+o+"_above"),s=document.querySelector("#"+o+"_below"),a="enter"===i?"block":"none";r&&(r.style.display=a),s&&(s.style.display=a)}return function(){var e=1,s={},a={},c=null,h=null,u=null,l=null,f=0,p=0,d=0,_=0,y=null,v=null,g=null,x=!1,m=!1,b=!1,w=!1,M=0,k=!1,S=!1,j=null,T=null,E=-1,N=null,O=[];function A(t){var n=0;if(t.offsetParent)do{n+=t.offsetTop,t=t.offsetParent}while(t);return n<0?0:n}function P(t){return+t.getAttribute("data-scrollama-index")}function C(){window.pageYOffset>E?N="down":window.pageYOffset<E&&(N="up"),E=window.pageYOffset}function R(){d=window.innerHeight,_=function(){var t=document.body,n=document.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight)}(),g=h?h.getBoundingClientRect():null,p=f*d,y=u?u.map(function(t){return t.offsetHeight}):[],v=u?u.map(A):[],m&&x&&$(),b&&o({id:l,stepOffsetHeight:y,offsetMargin:p,offsetVal:f})}function I(t){t&&!m?(x&&$(),m=!0):t||(a.top&&a.top.disconnect(),a.bottom&&a.bottom.disconnect(),a.stepAbove&&a.stepAbove.forEach(function(t){return t.disconnect()}),a.stepBelow&&a.stepBelow.forEach(function(t){return t.disconnect()}),a.stepProgress&&a.stepProgress.forEach(function(t){return t.disconnect()}),a.viewportAbove&&a.viewportAbove.forEach(function(t){return t.disconnect()}),a.viewportBelow&&a.viewportBelow.forEach(function(t){return t.disconnect()}),m=!1)}function B(t,n){if("above"===n)for(var e=0;e<t;e++){var i=j[e];"enter"===i.state&&q(u[e],"down"),"up"===i.direction&&(L(u[e],"down",!1),q(u[e],"down"))}else if("below"===n)for(var o=j.length-1;o>t;o--){var r=j[o];"enter"===r.state&&q(u[o],"up"),"down"===r.direction&&(L(u[o],"up",!1),q(u[o],"up"))}}function L(t,n,e){void 0===e&&(e=!0);var i=P(t),o={element:t,index:i,direction:n};j[i].direction=n,j[i].state="enter",k&&e&&"down"===n&&B(i,"above"),k&&e&&"up"===n&&B(i,"below"),s.stepEnter&&"function"==typeof s.stepEnter&&!O[i]&&(s.stepEnter(o,j),b&&r({id:l,index:i,state:"enter"}),S&&(O[i]=!0)),w&&H(t,"down"===n?0:1)}function q(t,n){var e=P(t),i={element:t,index:e,direction:n};j[e].direction=n,j[e].state="exit",w&&H(t,"down"===n?1:0),s.stepExit&&"function"==typeof s.stepExit&&(s.stepExit(i,j),b&&r({id:l,index:e,state:"exit"}))}function H(t,n){var e=P(t),i={element:t,index:e,progress:n};s.stepProgress&&"function"==typeof s.stepProgress&&s.stepProgress(i)}function z(){var t={direction:N};T.direction=N,T.state="enter",s.containerEnter&&"function"==typeof s.containerEnter&&s.containerEnter(t)}function D(){var t={direction:N};T.direction=N,T.state="exit",s.containerExit&&"function"==typeof s.containerExit&&s.containerExit(t)}function W(t){C(),t.forEach(function(t){var n=t.isIntersecting,i=t.boundingClientRect,o=t.target,r=i.bottom,s=i.height,a=r-p,c=P(o),h=j[c];a>=-e&&(n&&"down"===N&&"enter"!==h.state?L(o,N):n||"up"!==N||"enter"!==h.state?!n&&a>=s&&"down"===N&&"enter"===h.state&&q(o,N):q(o,N))})}function Y(t){C(),t.forEach(function(t){var n=t.isIntersecting,i=t.boundingClientRect,o=t.target,r=i.bottom,s=i.height,a=r-p,c=P(o),h=j[c];a>=-e&&a<s&&n&&"up"===N&&"enter"!==h.state?L(o,N):a<=e&&!n&&"down"===N&&"enter"===h.state&&q(o,N)})}function F(t){C(),t.forEach(function(t){var n=t.isIntersecting,e=t.target,i=P(e),o=j[i];n&&"down"===N&&"enter"!==o.state&&"down"!==o.direction&&(L(e,"down"),q(e,"down"))})}function X(t){C(),t.forEach(function(t){var n=t.isIntersecting,e=t.target,i=P(e),o=j[i];n&&"up"===N&&"enter"!==o.state&&"up"!==o.direction&&(L(e,"up"),q(e,"up"))})}function V(t){C(),t.forEach(function(t){var n=t.isIntersecting,i=t.intersectionRatio,o=t.boundingClientRect,r=t.target,s=o.bottom,a=s-p;n&&a>=-e&&H(r,+i.toFixed(3))})}function J(t){C();var n=t[0],i=n.isIntersecting,o=n.boundingClientRect,r=(o.top,o.bottom);r>-e&&(i?z():"enter"===T.state&&D())}function U(t){C();var n=t[0],i=n.isIntersecting,o=n.boundingClientRect,r=o.top;r<e&&(i?z():"enter"===T.state&&D())}function G(){a.stepProgress&&a.stepProgress.forEach(function(t){return t.disconnect()}),a.stepProgress=u.map(function(t,n){var e=y[n]-p,i=-d+p,o=e+"px 0px "+i+"px 0px",r=function(t){for(var n=Math.ceil(t/M),e=[],i=1/n,o=0;o<n;o++)e.push(o*i);return e}(y[n]),s={root:null,rootMargin:o,threshold:r},a=new IntersectionObserver(V,s);return a.observe(t),a})}function $(){a.viewportAbove&&a.viewportAbove.forEach(function(t){return t.disconnect()}),a.viewportAbove=u.map(function(t,n){var e=v[n],i=-(d-p+y[n]),o=e+"px 0px "+i+"px 0px",r={root:null,rootMargin:o,threshold:0},s=new IntersectionObserver(F,r);return s.observe(t),s}),a.viewportBelow&&a.viewportBelow.forEach(function(t){return t.disconnect()}),a.viewportBelow=u.map(function(t,n){var e=-(p+y[n]),i=_-v[n]-y[n]-p,o=e+"px 0px "+i+"px 0px",r={root:null,rootMargin:o,threshold:0},s=new IntersectionObserver(X,r);return s.observe(t),s}),a.stepAbove&&a.stepAbove.forEach(function(t){return t.disconnect()}),a.stepAbove=u.map(function(t,n){var e=y[n],i=-d+p,o=e+"px 0px "+i+"px 0px",r={root:null,rootMargin:o,threshold:0},s=new IntersectionObserver(W,r);return s.observe(t),s}),a.stepBelow&&a.stepBelow.forEach(function(t){return t.disconnect()}),a.stepBelow=u.map(function(t,n){var e=-p,i=_-d+y[n]+p,o=e+"px 0px "+i+"px 0px",r={root:null,rootMargin:o,threshold:0},s=new IntersectionObserver(Y,r);return s.observe(t),s}),w&&G(),c&&h&&(function(){a.top&&a.top.unobserve(c);var t={root:null,rootMargin:d+"px 0px -"+d+"px 0px",threshold:0};a.top=new IntersectionObserver(J,t),a.top.observe(c)}(),function(){a.bottom&&a.bottom.unobserve(c);var t={root:null,rootMargin:"-"+g.height+"px 0px "+g.height+"px 0px",threshold:0};a.bottom=new IntersectionObserver(U,t),a.bottom.observe(c)}())}var Z={};return Z.setup=function(e){var o=e.container,r=e.graphic,s=e.step,a=e.offset;void 0===a&&(a=.5);var p=e.progress;void 0===p&&(p=!1);var d=e.threshold;void 0===d&&(d=4);var _=e.debug;void 0===_&&(_=!1);var y=e.order;void 0===y&&(y=!0);var v=e.once;return void 0===v&&(v=!1),l=function(){var t="abcdefghijklmnopqrstuv",n=t.length,e=(new Date).getTime();return""+[0,0,0].map(function(e){return t[Math.floor(Math.random()*n)]}).join("")+e}(),u=function(n,e){return void 0===e&&(e=document),"string"==typeof n?t(e.querySelectorAll(n)):n instanceof Element?t([n]):n instanceof NodeList?t(n):n instanceof Array?n:[]}(s),c=o?n(o):null,h=r?n(r):null,u.length?(b=_,w=p,k=y,S=v,Z.offsetTrigger(a),M=Math.max(1,+d),x=!0,b&&i({id:l,stepEl:u,offsetVal:f}),u.forEach(function(t,n){return t.setAttribute("data-scrollama-index",n)}),j=u.map(function(){return{direction:null,state:null}}),T={direction:null,state:null},R(),I(!0),Z):(console.error("scrollama error: no step elements"),Z)},Z.resize=function(){return R(),Z},Z.enable=function(){return I(!0),Z},Z.disable=function(){return I(!1),Z},Z.destroy=function(){I(!1),Object.keys(s).forEach(function(t){return s[t]=null}),Object.keys(a).forEach(function(t){return a[t]=null})},Z.offsetTrigger=function(t){return t&&!isNaN(t)?(f=Math.min(Math.max(0,t),1),Z):f},Z.onStepEnter=function(t){return s.stepEnter=t,Z},Z.onStepExit=function(t){return s.stepExit=t,Z},Z.onStepProgress=function(t){return s.stepProgress=t,Z},Z.onContainerEnter=function(t){return s.containerEnter=t,Z},Z.onContainerExit=function(t){return s.containerExit=t,Z},Z}}()}});