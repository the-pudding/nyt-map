!function(t){var n={};function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(i,o,function(n){return t[n]}.bind(null,o));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=13)}({0:function(t,n){var e;e=function(){return this}();try{e=e||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(e=window)}t.exports=e},13:function(t,n,e){"use strict";e.r(n);var i=e(2),o=e.n(i),a={android:function(){return navigator.userAgent.match(/Android/i)},blackberry:function(){return navigator.userAgent.match(/BlackBerry/i)},ios:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},opera:function(){return navigator.userAgent.match(/Opera Mini/i)},windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return a.android()||a.blackberry()||a.ios()||a.opera()||a.windows()}},r=a,s="http://www.w3.org/1999/xhtml",c={svg:"http://www.w3.org/2000/svg",xhtml:s,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},h=function(t){var n=t+="",e=n.indexOf(":");return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),c.hasOwnProperty(n)?{space:c[n],local:t}:t};var u=function(t){var n=h(t);return(n.local?function(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}:function(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===s&&n.documentElement.namespaceURI===s?n.createElement(t):n.createElementNS(e,t)}})(n)},l=0;function f(){this._="@"+(++l).toString(36)}f.prototype=function(){return new f}.prototype={constructor:f,get:function(t){for(var n=this._;!(n in t);)if(!(t=t.parentNode))return;return t[n]},set:function(t,n){return t[this._]=n},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var _=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var p=document.documentElement;if(!p.matches){var y=p.webkitMatchesSelector||p.msMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector;_=function(t){return function(){return y.call(this,t)}}}}var d=_,v={},x=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||(v={mouseenter:"mouseover",mouseleave:"mouseout"}));function g(t,n,e){return t=m(t,n,e),function(n){var e=n.relatedTarget;e&&(e===this||8&e.compareDocumentPosition(this))||t.call(this,n)}}function m(t,n,e){return function(i){var o=x;x=i;try{t.call(this,this.__data__,n,e)}finally{x=o}}}function b(t){return function(){var n=this.__on;if(n){for(var e,i=0,o=-1,a=n.length;i<a;++i)e=n[i],t.type&&e.type!==t.type||e.name!==t.name?n[++o]=e:this.removeEventListener(e.type,e.listener,e.capture);++o?n.length=o:delete this.__on}}}function w(t,n,e){var i=v.hasOwnProperty(t.type)?g:m;return function(o,a,r){var s,c=this.__on,h=i(n,a,r);if(c)for(var u=0,l=c.length;u<l;++u)if((s=c[u]).type===t.type&&s.name===t.name)return this.removeEventListener(s.type,s.listener,s.capture),this.addEventListener(s.type,s.listener=h,s.capture=e),void(s.value=n);this.addEventListener(t.type,h,e),s={type:t.type,name:t.name,value:n,listener:h,capture:e},c?c.push(s):this.__on=[s]}}function M(t,n,e,i){var o=x;t.sourceEvent=x,x=t;try{return n.apply(e,i)}finally{x=o}}var j=function(){for(var t,n=x;t=n.sourceEvent;)n=t;return n},k=function(t,n){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var i=e.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}var o=t.getBoundingClientRect();return[n.clientX-o.left-t.clientLeft,n.clientY-o.top-t.clientTop]},S=function(t){var n=j();return n.changedTouches&&(n=n.changedTouches[0]),k(t,n)};function N(){}var T=function(t){return null==t?N:function(){return this.querySelector(t)}};function O(){return[]}var A=function(t){return new Array(t.length)};function P(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}P.prototype={constructor:P,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var E="$";function C(t,n,e,i,o,a){for(var r,s=0,c=n.length,h=a.length;s<h;++s)(r=n[s])?(r.__data__=a[s],i[s]=r):e[s]=new P(t,a[s]);for(;s<c;++s)(r=n[s])&&(o[s]=r)}function q(t,n,e,i,o,a,r){var s,c,h,u={},l=n.length,f=a.length,_=new Array(l);for(s=0;s<l;++s)(c=n[s])&&(_[s]=h=E+r.call(c,c.__data__,s,n),h in u?o[s]=c:u[h]=c);for(s=0;s<f;++s)(c=u[h=E+r.call(t,a[s],s,a)])?(i[s]=c,c.__data__=a[s],u[h]=null):e[s]=new P(t,a[s]);for(s=0;s<l;++s)(c=n[s])&&u[_[s]]===c&&(o[s]=c)}function R(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}var D=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function I(t){return t.trim().split(/^|\s+/)}function B(t){return t.classList||new z(t)}function z(t){this._node=t,this._names=I(t.getAttribute("class")||"")}function L(t,n){for(var e=B(t),i=-1,o=n.length;++i<o;)e.add(n[i])}function W(t,n){for(var e=B(t),i=-1,o=n.length;++i<o;)e.remove(n[i])}z.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function X(){this.textContent=""}function Y(){this.innerHTML=""}function H(){this.nextSibling&&this.parentNode.appendChild(this)}function V(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function F(){return null}function J(){var t=this.parentNode;t&&t.removeChild(this)}function U(t,n,e){var i=D(t),o=i.CustomEvent;o?o=new o(n,e):(o=i.document.createEvent("Event"),e?(o.initEvent(n,e.bubbles,e.cancelable),o.detail=e.detail):o.initEvent(n,!1,!1)),t.dispatchEvent(o)}var G=[null];function $(t,n){this._groups=t,this._parents=n}function Z(){return new $([[document.documentElement]],G)}$.prototype=Z.prototype={constructor:$,select:function(t){"function"!=typeof t&&(t=T(t));for(var n=this._groups,e=n.length,i=new Array(e),o=0;o<e;++o)for(var a,r,s=n[o],c=s.length,h=i[o]=new Array(c),u=0;u<c;++u)(a=s[u])&&(r=t.call(a,a.__data__,u,s))&&("__data__"in a&&(r.__data__=a.__data__),h[u]=r);return new $(i,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=function(t){return null==t?O:function(){return this.querySelectorAll(t)}}(t));for(var n=this._groups,e=n.length,i=[],o=[],a=0;a<e;++a)for(var r,s=n[a],c=s.length,h=0;h<c;++h)(r=s[h])&&(i.push(t.call(r,r.__data__,h,s)),o.push(r));return new $(i,o)},filter:function(t){"function"!=typeof t&&(t=d(t));for(var n=this._groups,e=n.length,i=new Array(e),o=0;o<e;++o)for(var a,r=n[o],s=r.length,c=i[o]=[],h=0;h<s;++h)(a=r[h])&&t.call(a,a.__data__,h,r)&&c.push(a);return new $(i,this._parents)},data:function(t,n){if(!t)return _=new Array(this.size()),h=-1,this.each(function(t){_[++h]=t}),_;var e=n?q:C,i=this._parents,o=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var a=o.length,r=new Array(a),s=new Array(a),c=new Array(a),h=0;h<a;++h){var u=i[h],l=o[h],f=l.length,_=t.call(u,u&&u.__data__,h,i),p=_.length,y=s[h]=new Array(p),d=r[h]=new Array(p);e(u,l,y,d,c[h]=new Array(f),_,n);for(var v,x,g=0,m=0;g<p;++g)if(v=y[g]){for(g>=m&&(m=g+1);!(x=d[m])&&++m<p;);v._next=x||null}}return(r=new $(r,i))._enter=s,r._exit=c,r},enter:function(){return new $(this._enter||this._groups.map(A),this._parents)},exit:function(){return new $(this._exit||this._groups.map(A),this._parents)},merge:function(t){for(var n=this._groups,e=t._groups,i=n.length,o=e.length,a=Math.min(i,o),r=new Array(i),s=0;s<a;++s)for(var c,h=n[s],u=e[s],l=h.length,f=r[s]=new Array(l),_=0;_<l;++_)(c=h[_]||u[_])&&(f[_]=c);for(;s<i;++s)r[s]=n[s];return new $(r,this._parents)},order:function(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var i,o=t[n],a=o.length-1,r=o[a];--a>=0;)(i=o[a])&&(r&&r!==i.nextSibling&&r.parentNode.insertBefore(i,r),r=i);return this},sort:function(t){function n(n,e){return n&&e?t(n.__data__,e.__data__):!n-!e}t||(t=R);for(var e=this._groups,i=e.length,o=new Array(i),a=0;a<i;++a){for(var r,s=e[a],c=s.length,h=o[a]=new Array(c),u=0;u<c;++u)(r=s[u])&&(h[u]=r);h.sort(n)}return new $(o,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),n=-1;return this.each(function(){t[++n]=this}),t},node:function(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var i=t[n],o=0,a=i.length;o<a;++o){var r=i[o];if(r)return r}return null},size:function(){var t=0;return this.each(function(){++t}),t},empty:function(){return!this.node()},each:function(t){for(var n=this._groups,e=0,i=n.length;e<i;++e)for(var o,a=n[e],r=0,s=a.length;r<s;++r)(o=a[r])&&t.call(o,o.__data__,r,a);return this},attr:function(t,n){var e=h(t);if(arguments.length<2){var i=this.node();return e.local?i.getAttributeNS(e.space,e.local):i.getAttribute(e)}return this.each((null==n?e.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}}:"function"==typeof n?e.local?function(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}:function(t,n){return function(){var e=n.apply(this,arguments);null==e?this.removeAttribute(t):this.setAttribute(t,e)}}:e.local?function(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}:function(t,n){return function(){this.setAttribute(t,n)}})(e,n))},style:function(t,n,e){var i;return arguments.length>1?this.each((null==n?function(t){return function(){this.style.removeProperty(t)}}:"function"==typeof n?function(t,n,e){return function(){var i=n.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,e)}}:function(t,n,e){return function(){this.style.setProperty(t,n,e)}})(t,n,null==e?"":e)):D(i=this.node()).getComputedStyle(i,null).getPropertyValue(t)},property:function(t,n){return arguments.length>1?this.each((null==n?function(t){return function(){delete this[t]}}:"function"==typeof n?function(t,n){return function(){var e=n.apply(this,arguments);null==e?delete this[t]:this[t]=e}}:function(t,n){return function(){this[t]=n}})(t,n)):this.node()[t]},classed:function(t,n){var e=I(t+"");if(arguments.length<2){for(var i=B(this.node()),o=-1,a=e.length;++o<a;)if(!i.contains(e[o]))return!1;return!0}return this.each(("function"==typeof n?function(t,n){return function(){(n.apply(this,arguments)?L:W)(this,t)}}:n?function(t){return function(){L(this,t)}}:function(t){return function(){W(this,t)}})(e,n))},text:function(t){return arguments.length?this.each(null==t?X:("function"==typeof t?function(t){return function(){var n=t.apply(this,arguments);this.textContent=null==n?"":n}}:function(t){return function(){this.textContent=t}})(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Y:("function"==typeof t?function(t){return function(){var n=t.apply(this,arguments);this.innerHTML=null==n?"":n}}:function(t){return function(){this.innerHTML=t}})(t)):this.node().innerHTML},raise:function(){return this.each(H)},lower:function(){return this.each(V)},append:function(t){var n="function"==typeof t?t:u(t);return this.select(function(){return this.appendChild(n.apply(this,arguments))})},insert:function(t,n){var e="function"==typeof t?t:u(t),i=null==n?F:"function"==typeof n?n:T(n);return this.select(function(){return this.insertBefore(e.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(J)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,n,e){var i,o,a=function(t){return t.trim().split(/^|\s+/).map(function(t){var n="",e=t.indexOf(".");return e>=0&&(n=t.slice(e+1),t=t.slice(0,e)),{type:t,name:n}})}(t+""),r=a.length;if(!(arguments.length<2)){for(s=n?w:b,null==e&&(e=!1),i=0;i<r;++i)this.each(s(a[i],n,e));return this}var s=this.node().__on;if(s)for(var c,h=0,u=s.length;h<u;++h)for(i=0,c=s[h];i<r;++i)if((o=a[i]).type===c.type&&o.name===c.name)return c.value},dispatch:function(t,n){return this.each(("function"==typeof n?function(t,n){return function(){return U(this,t,n.apply(this,arguments))}}:function(t,n){return function(){return U(this,t,n)}})(t,n))}};var Q=function(t){return"string"==typeof t?new $([[document.querySelector(t)]],[document.documentElement]):new $([[t]],G)},K=function(t,n,e){arguments.length<3&&(e=n,n=j().changedTouches);for(var i,o=0,a=n?n.length:0;o<a;++o)if((i=n[o]).identifier===e)return k(t,i);return null},tt={value:function(){}};function nt(){for(var t,n=0,e=arguments.length,i={};n<e;++n){if(!(t=arguments[n]+"")||t in i)throw new Error("illegal type: "+t);i[t]=[]}return new et(i)}function et(t){this._=t}function it(t,n){for(var e,i=0,o=t.length;i<o;++i)if((e=t[i]).name===n)return e.value}function ot(t,n,e){for(var i=0,o=t.length;i<o;++i)if(t[i].name===n){t[i]=tt,t=t.slice(0,i).concat(t.slice(i+1));break}return null!=e&&t.push({name:n,value:e}),t}et.prototype=nt.prototype={constructor:et,on:function(t,n){var e,i=this._,o=function(t,n){return t.trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");if(i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})}(t+"",i),a=-1,r=o.length;if(!(arguments.length<2)){if(null!=n&&"function"!=typeof n)throw new Error("invalid callback: "+n);for(;++a<r;)if(e=(t=o[a]).type)i[e]=ot(i[e],t.name,n);else if(null==n)for(e in i)i[e]=ot(i[e],t.name,null);return this}for(;++a<r;)if((e=(t=o[a]).type)&&(e=it(i[e],t.name)))return e},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new et(t)},call:function(t,n){if((e=arguments.length-2)>0)for(var e,i,o=new Array(e),a=0;a<e;++a)o[a]=arguments[a+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=0,e=(i=this._[t]).length;a<e;++a)i[a].value.apply(n,o)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],o=0,a=i.length;o<a;++o)i[o].value.apply(n,e)}};var at=nt;function rt(){x.stopImmediatePropagation()}var st=function(){x.preventDefault(),x.stopImmediatePropagation()},ct=function(t){var n=t.document.documentElement,e=Q(t).on("dragstart.drag",st,!0);"onselectstart"in n?e.on("selectstart.drag",st,!0):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")};var ht=function(t){return function(){return t}};function ut(t,n,e,i,o,a,r,s,c,h){this.target=t,this.type=n,this.subject=e,this.identifier=i,this.active=o,this.x=a,this.y=r,this.dx=s,this.dy=c,this._=h}function lt(){return!x.button}function ft(){return this.parentNode}function _t(t){return null==t?{x:x.x,y:x.y}:t}ut.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var pt=function(){var t,n,e=lt,i=ft,o=_t,a={},r=at("start","drag","end"),s=0;function c(t){t.on("mousedown.drag",h).on("touchstart.drag",f).on("touchmove.drag",_).on("touchend.drag touchcancel.drag",p).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function h(){if(!n&&e.apply(this,arguments)){var o=y("mouse",i.apply(this,arguments),S,this,arguments);o&&(Q(x.view).on("mousemove.drag",u,!0).on("mouseup.drag",l,!0),ct(x.view),rt(),t=!1,o("start"))}}function u(){st(),t=!0,a.mouse("drag")}function l(){Q(x.view).on("mousemove.drag mouseup.drag",null),function(t,n){var e=t.document.documentElement,i=Q(t).on("dragstart.drag",null);n&&(i.on("click.drag",st,!0),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in e?i.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}(x.view,t),st(),a.mouse("end")}function f(){if(e.apply(this,arguments)){var t,n,o=x.changedTouches,a=i.apply(this,arguments),r=o.length;for(t=0;t<r;++t)(n=y(o[t].identifier,a,K,this,arguments))&&(rt(),n("start"))}}function _(){var t,n,e=x.changedTouches,i=e.length;for(t=0;t<i;++t)(n=a[e[t].identifier])&&(st(),n("drag"))}function p(){var t,e,i=x.changedTouches,o=i.length;for(n&&clearTimeout(n),n=setTimeout(function(){n=null},500),t=0;t<o;++t)(e=a[i[t].identifier])&&(rt(),e("end"))}function y(t,n,e,i,h){var u,l,f,_=e(n,t),p=r.copy();if(M(new ut(c,"beforestart",u,t,s,_[0],_[1],0,0,p),function(){return null!=(x.subject=u=o.apply(i,h))&&(l=u.x-_[0]||0,f=u.y-_[1]||0,!0)}))return function o(r){var y,d=_;switch(r){case"start":a[t]=o,y=s++;break;case"end":delete a[t],--s;case"drag":_=e(n,t),y=s}M(new ut(c,r,u,t,y,_[0]+l,_[1]+f,_[0]-d[0],_[1]-d[1],p),p.apply,p,[r,i,h])}}return c.filter=function(t){return arguments.length?(e="function"==typeof t?t:ht(!!t),c):e},c.container=function(t){return arguments.length?(i="function"==typeof t?t:ht(t),c):i},c.subject=function(t){return arguments.length?(o="function"==typeof t?t:ht(t),c):o},c.on=function(){var t=r.on.apply(r,arguments);return t===r?c:t},c},yt=Math.PI,dt=2*yt,vt=dt-1e-6;function xt(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function gt(){return new xt}xt.prototype=gt.prototype={constructor:xt,moveTo:function(t,n){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+n)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,n){this._+="L"+(this._x1=+t)+","+(this._y1=+n)},quadraticCurveTo:function(t,n,e,i){this._+="Q"+ +t+","+ +n+","+(this._x1=+e)+","+(this._y1=+i)},bezierCurveTo:function(t,n,e,i,o,a){this._+="C"+ +t+","+ +n+","+ +e+","+ +i+","+(this._x1=+o)+","+(this._y1=+a)},arcTo:function(t,n,e,i,o){t=+t,n=+n,e=+e,i=+i,o=+o;var a=this._x1,r=this._y1,s=e-t,c=i-n,h=a-t,u=r-n,l=h*h+u*u;if(o<0)throw new Error("negative radius: "+o);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=n);else if(l>1e-6)if(Math.abs(u*s-c*h)>1e-6&&o){var f=e-a,_=i-r,p=s*s+c*c,y=f*f+_*_,d=Math.sqrt(p),v=Math.sqrt(l),x=o*Math.tan((yt-Math.acos((p+l-y)/(2*d*v)))/2),g=x/v,m=x/d;Math.abs(g-1)>1e-6&&(this._+="L"+(t+g*h)+","+(n+g*u)),this._+="A"+o+","+o+",0,0,"+ +(u*f>h*_)+","+(this._x1=t+m*s)+","+(this._y1=n+m*c)}else this._+="L"+(this._x1=t)+","+(this._y1=n);else;},arc:function(t,n,e,i,o,a){t=+t,n=+n;var r=(e=+e)*Math.cos(i),s=e*Math.sin(i),c=t+r,h=n+s,u=1^a,l=a?i-o:o-i;if(e<0)throw new Error("negative radius: "+e);null===this._x1?this._+="M"+c+","+h:(Math.abs(this._x1-c)>1e-6||Math.abs(this._y1-h)>1e-6)&&(this._+="L"+c+","+h),e&&(l<0&&(l=l%dt+dt),l>vt?this._+="A"+e+","+e+",0,1,"+u+","+(t-r)+","+(n-s)+"A"+e+","+e+",0,1,"+u+","+(this._x1=c)+","+(this._y1=h):l>1e-6&&(this._+="A"+e+","+e+",0,"+ +(l>=yt)+","+u+","+(this._x1=t+e*Math.cos(o))+","+(this._y1=n+e*Math.sin(o))))},rect:function(t,n,e,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+n)+"h"+ +e+"v"+ +i+"h"+-e+"Z"},toString:function(){return this._}};var mt=gt,bt=function(t){return function(){return t}},wt=1e-12,Mt=Math.PI,jt=Mt/2,kt=2*Mt;function St(t){return t.innerRadius}function Nt(t){return t.outerRadius}function Tt(t){return t.startAngle}function Ot(t){return t.endAngle}function At(t){return t&&t.padAngle}function Pt(t){return t>=1?jt:t<=-1?-jt:Math.asin(t)}function Et(t,n,e,i,o,a,r){var s=t-e,c=n-i,h=(r?a:-a)/Math.sqrt(s*s+c*c),u=h*c,l=-h*s,f=t+u,_=n+l,p=e+u,y=i+l,d=(f+p)/2,v=(_+y)/2,x=p-f,g=y-_,m=x*x+g*g,b=o-a,w=f*y-p*_,M=(g<0?-1:1)*Math.sqrt(Math.max(0,b*b*m-w*w)),j=(w*g-x*M)/m,k=(-w*x-g*M)/m,S=(w*g+x*M)/m,N=(-w*x+g*M)/m,T=j-d,O=k-v,A=S-d,P=N-v;return T*T+O*O>A*A+P*P&&(j=S,k=N),{cx:j,cy:k,x01:-u,y01:-l,x11:j*(o/b-1),y11:k*(o/b-1)}}function Ct(t){this._context=t}Ct.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:this._context.lineTo(t,n)}}};var qt=function(t){return new Ct(t)};function Rt(t){return t[0]}function Dt(t){return t[1]}var It=function(){var t=Rt,n=Dt,e=bt(!0),i=null,o=qt,a=null;function r(r){var s,c,h,u=r.length,l=!1;for(null==i&&(a=o(h=mt())),s=0;s<=u;++s)!(s<u&&e(c=r[s],s,r))===l&&((l=!l)?a.lineStart():a.lineEnd()),l&&a.point(+t(c,s,r),+n(c,s,r));if(h)return a=null,h+""||null}return r.x=function(n){return arguments.length?(t="function"==typeof n?n:bt(+n),r):t},r.y=function(t){return arguments.length?(n="function"==typeof t?t:bt(+t),r):n},r.defined=function(t){return arguments.length?(e="function"==typeof t?t:bt(!!t),r):e},r.curve=function(t){return arguments.length?(o=t,null!=i&&(a=o(i)),r):o},r.context=function(t){return arguments.length?(null==t?i=a=null:a=o(i=t),r):i},r};zt(qt);function Bt(t){this._curve=t}function zt(t){function n(n){return new Bt(t(n))}return n._curve=t,n}Bt.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,n){this._curve.point(n*Math.sin(t),n*-Math.cos(t))}};Math.sqrt(1/3);var Lt=Math.sin(Mt/10)/Math.sin(7*Mt/10),Wt=(Math.sin(kt/10),Math.cos(kt/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12),function(){});function Xt(t,n,e){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+n)/6,(t._y0+4*t._y1+e)/6)}function Yt(t){this._context=t}Yt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Xt(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Xt(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}};function Ht(t){this._context=t}Ht.prototype={areaStart:Wt,areaEnd:Wt,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._x2=t,this._y2=n;break;case 1:this._point=2,this._x3=t,this._y3=n;break;case 2:this._point=3,this._x4=t,this._y4=n,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+n)/6);break;default:Xt(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}};function Vt(t){this._context=t}Vt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var e=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+n)/6;this._line?this._context.lineTo(e,i):this._context.moveTo(e,i);break;case 3:this._point=4;default:Xt(this,t,n)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n}};function Ft(t,n){this._basis=new Yt(t),this._beta=n}Ft.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,n=this._y,e=t.length-1;if(e>0)for(var i,o=t[0],a=n[0],r=t[e]-o,s=n[e]-a,c=-1;++c<=e;)i=c/e,this._basis.point(this._beta*t[c]+(1-this._beta)*(o+i*r),this._beta*n[c]+(1-this._beta)*(a+i*s));this._x=this._y=null,this._basis.lineEnd()},point:function(t,n){this._x.push(+t),this._y.push(+n)}};(function t(n){function e(t){return 1===n?new Yt(t):new Ft(t,n)}return e.beta=function(n){return t(+n)},e})(.85);function Jt(t,n,e){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-n),t._y2+t._k*(t._y1-e),t._x2,t._y2)}function Ut(t,n){this._context=t,this._k=(1-n)/6}Ut.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Jt(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2,this._x1=t,this._y1=n;break;case 2:this._point=3;default:Jt(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};(function t(n){function e(t){return new Ut(t,n)}return e.tension=function(n){return t(+n)},e})(0);function Gt(t,n){this._context=t,this._k=(1-n)/6}Gt.prototype={areaStart:Wt,areaEnd:Wt,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._x3=t,this._y3=n;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=n);break;case 2:this._point=3,this._x5=t,this._y5=n;break;default:Jt(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};(function t(n){function e(t){return new Gt(t,n)}return e.tension=function(n){return t(+n)},e})(0);function $t(t,n){this._context=t,this._k=(1-n)/6}$t.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Jt(this,t,n)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};(function t(n){function e(t){return new $t(t,n)}return e.tension=function(n){return t(+n)},e})(0);function Zt(t,n,e){var i=t._x1,o=t._y1,a=t._x2,r=t._y2;if(t._l01_a>wt){var s=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,c=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*s-t._x0*t._l12_2a+t._x2*t._l01_2a)/c,o=(o*s-t._y0*t._l12_2a+t._y2*t._l01_2a)/c}if(t._l23_a>wt){var h=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,u=3*t._l23_a*(t._l23_a+t._l12_a);a=(a*h+t._x1*t._l23_2a-n*t._l12_2a)/u,r=(r*h+t._y1*t._l23_2a-e*t._l12_2a)/u}t._context.bezierCurveTo(i,o,a,r,t._x2,t._y2)}function Qt(t,n){this._context=t,this._alpha=n}Qt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,i=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3;default:Zt(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};var Kt=function t(n){function e(t){return n?new Qt(t,n):new Ut(t,0)}return e.alpha=function(n){return t(+n)},e}(.5);function tn(t,n){this._context=t,this._alpha=n}tn.prototype={areaStart:Wt,areaEnd:Wt,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,i=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=n;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=n);break;case 2:this._point=3,this._x5=t,this._y5=n;break;default:Zt(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};(function t(n){function e(t){return n?new tn(t,n):new Gt(t,0)}return e.alpha=function(n){return t(+n)},e})(.5);function nn(t,n){this._context=t,this._alpha=n}nn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){if(t=+t,n=+n,this._point){var e=this._x2-t,i=this._y2-n;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(e*e+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Zt(this,t,n)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=n}};(function t(n){function e(t){return n?new nn(t,n):new $t(t,0)}return e.alpha=function(n){return t(+n)},e})(.5);function en(t){this._context=t}en.prototype={areaStart:Wt,areaEnd:Wt,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,n){t=+t,n=+n,this._point?this._context.lineTo(t,n):(this._point=1,this._context.moveTo(t,n))}};function on(t){return t<0?-1:1}function an(t,n,e){var i=t._x1-t._x0,o=n-t._x1,a=(t._y1-t._y0)/(i||o<0&&-0),r=(e-t._y1)/(o||i<0&&-0),s=(a*o+r*i)/(i+o);return(on(a)+on(r))*Math.min(Math.abs(a),Math.abs(r),.5*Math.abs(s))||0}function rn(t,n){var e=t._x1-t._x0;return e?(3*(t._y1-t._y0)/e-n)/2:n}function sn(t,n,e){var i=t._x0,o=t._y0,a=t._x1,r=t._y1,s=(a-i)/3;t._context.bezierCurveTo(i+s,o+s*n,a-s,r-s*e,a,r)}function cn(t){this._context=t}function hn(t){this._context=new un(t)}function un(t){this._context=t}function ln(t){this._context=t}function fn(t){var n,e,i=t.length-1,o=new Array(i),a=new Array(i),r=new Array(i);for(o[0]=0,a[0]=2,r[0]=t[0]+2*t[1],n=1;n<i-1;++n)o[n]=1,a[n]=4,r[n]=4*t[n]+2*t[n+1];for(o[i-1]=2,a[i-1]=7,r[i-1]=8*t[i-1]+t[i],n=1;n<i;++n)e=o[n]/a[n-1],a[n]-=e,r[n]-=e*r[n-1];for(o[i-1]=r[i-1]/a[i-1],n=i-2;n>=0;--n)o[n]=(r[n]-o[n+1])/a[n];for(a[i-1]=(t[i]+o[i-1])/2,n=0;n<i-1;++n)a[n]=2*t[n+1]-o[n+1];return[o,a]}cn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:sn(this,this._t0,rn(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,n){var e=NaN;if(n=+n,(t=+t)!==this._x1||n!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;break;case 2:this._point=3,sn(this,rn(this,e=an(this,t,n)),e);break;default:sn(this,this._t0,e=an(this,t,n))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=n,this._t0=e}}},(hn.prototype=Object.create(cn.prototype)).point=function(t,n){cn.prototype.point.call(this,n,t)},un.prototype={moveTo:function(t,n){this._context.moveTo(n,t)},closePath:function(){this._context.closePath()},lineTo:function(t,n){this._context.lineTo(n,t)},bezierCurveTo:function(t,n,e,i,o,a){this._context.bezierCurveTo(n,t,i,e,a,o)}},ln.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,n=this._y,e=t.length;if(e)if(this._line?this._context.lineTo(t[0],n[0]):this._context.moveTo(t[0],n[0]),2===e)this._context.lineTo(t[1],n[1]);else for(var i=fn(t),o=fn(n),a=0,r=1;r<e;++a,++r)this._context.bezierCurveTo(i[0][a],o[0][a],i[1][a],o[1][a],t[r],n[r]);(this._line||0!==this._line&&1===e)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,n){this._x.push(+t),this._y.push(+n)}};function _n(t,n){this._context=t,this._t=n}_n.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,n){switch(t=+t,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,n):this._context.moveTo(t,n);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(t,n);else{var e=this._x*(1-this._t)+t*this._t;this._context.lineTo(e,this._y),this._context.lineTo(e,n)}}this._x=t,this._y=n}};Array.prototype.slice;var pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yn=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},dn=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),vn=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},xn=function t(n,e,i){null===n&&(n=Function.prototype);var o=Object.getOwnPropertyDescriptor(n,e);if(void 0===o){var a=Object.getPrototypeOf(n);return null===a?void 0:t(a,e,i)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(i):void 0},gn=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},mn=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},bn=function(){function t(n){var e=n.x,i=void 0===e?0:e,o=n.y,a=void 0===o?0:o,r=n.nx,s=n.ny,c=n.dy,h=void 0===c?0:c,u=n.dx,l=void 0===u?0:u,f=n.color,_=void 0===f?"grey":f,p=n.data,y=n.type,d=n.subject,v=n.connector,x=n.note,g=n.disable,m=n.id,b=n.className;yn(this,t),this._dx=void 0!==r?r-i:l,this._dy=void 0!==s?s-a:h,this._x=i,this._y=a,this._color=_,this.id=m,this._className=b||"",this._type=y||"",this.data=p,this.note=x||{},this.connector=v||{},this.subject=d||{},this.disable=g||[]}return dn(t,[{key:"updatePosition",value:function(){this.type.setPosition&&(this.type.setPosition(),this.type.subject&&0!==this.type.subject.selectAll(":not(.handle)").nodes().length&&this.type.redrawSubject())}},{key:"clearComponents",value:function(){this.type.clearComponents&&this.type.clearComponents()}},{key:"updateOffset",value:function(){this.type.setOffset&&(this.type.setOffset(),0!==this.type.connector.selectAll(":not(.handle)").nodes().length&&this.type.redrawConnector(),this.type.redrawNote())}},{key:"className",get:function(){return this._className},set:function(t){this._className=t,this.type.setClassName&&this.type.setClassName()}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this.clearComponents()}},{key:"x",get:function(){return this._x},set:function(t){this._x=t,this.updatePosition()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this.updatePosition()}},{key:"color",get:function(){return this._color},set:function(t){this._color=t,this.updatePosition()}},{key:"dx",get:function(){return this._dx},set:function(t){this._dx=t,this.updateOffset()}},{key:"dy",get:function(){return this._dy},set:function(t){this._dy=t,this.updateOffset()}},{key:"nx",set:function(t){this._dx=t-this._x,this.updateOffset()}},{key:"ny",set:function(t){this._dy=t-this._y,this.updateOffset()}},{key:"offset",get:function(){return{x:this._dx,y:this._dy}},set:function(t){var n=t.x,e=t.y;this._dx=n,this._dy=e,this.updateOffset()}},{key:"position",get:function(){return{x:this._x,y:this._y}},set:function(t){var n=t.x,e=t.y;this._x=n,this._y=e,this.updatePosition()}},{key:"translation",get:function(){return{x:this._x+this._dx,y:this._y+this._dy}}},{key:"json",get:function(){var t={x:this._x,y:this._y,dx:this._dx,dy:this._dy};return this.data&&Object.keys(this.data).length>0&&(t.data=this.data),this.type&&(t.type=this.type),this._className&&(t.className=this._className),Object.keys(this.connector).length>0&&(t.connector=this.connector),Object.keys(this.subject).length>0&&(t.subject=this.subject),Object.keys(this.note).length>0&&(t.note=this.note),t}}]),t}(),wn=function(){function t(n){var e=n.annotations,i=n.accessors,o=n.accessorsInverse;yn(this,t),this.accessors=i,this.accessorsInverse=o,this.annotations=e}return dn(t,[{key:"clearTypes",value:function(t){this.annotations.forEach(function(n){n.type=void 0,n.subject=t&&t.subject||n.subject,n.connector=t&&t.connector||n.connector,n.note=t&&t.note||n.note})}},{key:"setPositionWithAccessors",value:function(){var t=this;this.annotations.forEach(function(n){n.type.setPositionWithAccessors(t.accessors)})}},{key:"editMode",value:function(t){this.annotations.forEach(function(n){n.type&&(n.type.editMode=t,n.type.updateEditMode())})}},{key:"updateDisable",value:function(t){this.annotations.forEach(function(n){n.disable=t,n.type&&t.forEach(function(t){n.type[t]&&(n.type[t].remove&&n.type[t].remove(),n.type[t]=void 0)})})}},{key:"updateTextWrap",value:function(t){this.annotations.forEach(function(n){n.type&&n.type.updateTextWrap&&n.type.updateTextWrap(t)})}},{key:"updateText",value:function(){this.annotations.forEach(function(t){t.type&&t.type.drawText&&t.type.drawText()})}},{key:"updateNotePadding",value:function(t){this.annotations.forEach(function(n){n.type&&(n.type.notePadding=t)})}},{key:"json",get:function(){var t=this;return this.annotations.map(function(n){var e=n.json;return t.accessorsInverse&&n.data&&(e.data={},Object.keys(t.accessorsInverse).forEach(function(i){e.data[i]=t.accessorsInverse[i]({x:n.x,y:n.y})})),e})}},{key:"noteNodes",get:function(){return this.annotations.map(function(t){return vn({},t.type.getNoteBBoxOffset(),{positionX:t.x,positionY:t.y})})}}]),t}(),Mn=function(t,n){return"dynamic"!==t&&"left"!==t&&"right"!==t||(t=n<0?"top":"bottom"),t},jn=function(t,n){return"dynamic"!==t&&"top"!==t&&"bottom"!==t||(t=n<0?"right":"left"),t},kn=["topBottom","top","bottom"],Sn=["leftRight","left","right"],Nn=function(t){var n=t.data,e=t.curve,i=void 0===e?qt:e,o=t.canvasContext,a=t.className,r=t.classID,s=It().curve(i),c={type:"path",className:a,classID:r,data:n};return o?(s.context(o),c.pathMethods=s):c.attrs={d:s(n)},c},Tn=function(t){var n=t.data,e=t.canvasContext,i={type:"path",className:t.className,classID:t.classID,data:n},o=function(){var t=St,n=Nt,e=bt(0),i=null,o=Tt,a=Ot,r=At,s=null;function c(){var c,h,u=+t.apply(this,arguments),l=+n.apply(this,arguments),f=o.apply(this,arguments)-jt,_=a.apply(this,arguments)-jt,p=Math.abs(_-f),y=_>f;if(s||(s=c=mt()),l<u&&(h=l,l=u,u=h),l>wt)if(p>kt-wt)s.moveTo(l*Math.cos(f),l*Math.sin(f)),s.arc(0,0,l,f,_,!y),u>wt&&(s.moveTo(u*Math.cos(_),u*Math.sin(_)),s.arc(0,0,u,_,f,y));else{var d,v,x=f,g=_,m=f,b=_,w=p,M=p,j=r.apply(this,arguments)/2,k=j>wt&&(i?+i.apply(this,arguments):Math.sqrt(u*u+l*l)),S=Math.min(Math.abs(l-u)/2,+e.apply(this,arguments)),N=S,T=S;if(k>wt){var O=Pt(k/u*Math.sin(j)),A=Pt(k/l*Math.sin(j));(w-=2*O)>wt?(m+=O*=y?1:-1,b-=O):(w=0,m=b=(f+_)/2),(M-=2*A)>wt?(x+=A*=y?1:-1,g-=A):(M=0,x=g=(f+_)/2)}var P=l*Math.cos(x),E=l*Math.sin(x),C=u*Math.cos(b),q=u*Math.sin(b);if(S>wt){var R=l*Math.cos(g),D=l*Math.sin(g),I=u*Math.cos(m),B=u*Math.sin(m);if(p<Mt){var z=w>wt?function(t,n,e,i,o,a,r,s){var c=e-t,h=i-n,u=r-o,l=s-a,f=(u*(n-a)-l*(t-o))/(l*c-u*h);return[t+f*c,n+f*h]}(P,E,I,B,R,D,C,q):[C,q],L=P-z[0],W=E-z[1],X=R-z[0],Y=D-z[1],H=1/Math.sin(Math.acos((L*X+W*Y)/(Math.sqrt(L*L+W*W)*Math.sqrt(X*X+Y*Y)))/2),V=Math.sqrt(z[0]*z[0]+z[1]*z[1]);N=Math.min(S,(u-V)/(H-1)),T=Math.min(S,(l-V)/(H+1))}}M>wt?T>wt?(d=Et(I,B,P,E,l,T,y),v=Et(R,D,C,q,l,T,y),s.moveTo(d.cx+d.x01,d.cy+d.y01),T<S?s.arc(d.cx,d.cy,T,Math.atan2(d.y01,d.x01),Math.atan2(v.y01,v.x01),!y):(s.arc(d.cx,d.cy,T,Math.atan2(d.y01,d.x01),Math.atan2(d.y11,d.x11),!y),s.arc(0,0,l,Math.atan2(d.cy+d.y11,d.cx+d.x11),Math.atan2(v.cy+v.y11,v.cx+v.x11),!y),s.arc(v.cx,v.cy,T,Math.atan2(v.y11,v.x11),Math.atan2(v.y01,v.x01),!y))):(s.moveTo(P,E),s.arc(0,0,l,x,g,!y)):s.moveTo(P,E),u>wt&&w>wt?N>wt?(d=Et(C,q,R,D,u,-N,y),v=Et(P,E,I,B,u,-N,y),s.lineTo(d.cx+d.x01,d.cy+d.y01),N<S?s.arc(d.cx,d.cy,N,Math.atan2(d.y01,d.x01),Math.atan2(v.y01,v.x01),!y):(s.arc(d.cx,d.cy,N,Math.atan2(d.y01,d.x01),Math.atan2(d.y11,d.x11),!y),s.arc(0,0,u,Math.atan2(d.cy+d.y11,d.cx+d.x11),Math.atan2(v.cy+v.y11,v.cx+v.x11),y),s.arc(v.cx,v.cy,N,Math.atan2(v.y11,v.x11),Math.atan2(v.y01,v.x01),!y))):s.arc(0,0,u,b,m,y):s.lineTo(C,q)}else s.moveTo(0,0);if(s.closePath(),c)return s=null,c+""||null}return c.centroid=function(){var e=(+t.apply(this,arguments)+ +n.apply(this,arguments))/2,i=(+o.apply(this,arguments)+ +a.apply(this,arguments))/2-Mt/2;return[Math.cos(i)*e,Math.sin(i)*e]},c.innerRadius=function(n){return arguments.length?(t="function"==typeof n?n:bt(+n),c):t},c.outerRadius=function(t){return arguments.length?(n="function"==typeof t?t:bt(+t),c):n},c.cornerRadius=function(t){return arguments.length?(e="function"==typeof t?t:bt(+t),c):e},c.padRadius=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:bt(+t),c):i},c.startAngle=function(t){return arguments.length?(o="function"==typeof t?t:bt(+t),c):o},c.endAngle=function(t){return arguments.length?(a="function"==typeof t?t:bt(+t),c):a},c.padAngle=function(t){return arguments.length?(r="function"==typeof t?t:bt(+t),c):r},c.context=function(t){return arguments.length?(s=null==t?null:t,c):s},c}().innerRadius(n.innerRadius||0).outerRadius(n.outerRadius||n.radius||2).startAngle(n.startAngle||0).endAngle(n.endAngle||2*Math.PI);return e?(o.context(e),i.pathMethods=lineGen):i.attrs={d:o()},i},On=function(t){var n=t.type,e=t.subjectType,i=n.annotation,o=i.position,a=i.x-o.x,r=a+i.dx,s=i.y-o.y,c=s+i.dy,h=i.subject;if("circle"===e&&(h.outerRadius||h.radius)){var u=Math.sqrt((a-r)*(a-r)+(s-c)*(s-c)),l=Math.asin(-c/u),f=h.outerRadius||h.radius+(h.radiusPadding||0);a=Math.abs(Math.cos(l)*f)*(r<0?-1:1),s=Math.abs(Math.sin(l)*f)*(c<0?-1:1)}if("rect"===e){var _=h.width,p=h.height;(_>0&&i.dx>0||_<0&&i.dx<0)&&(a=Math.abs(_)>Math.abs(i.dx)?_/2:_),(p>0&&i.dy>0||p<0&&i.dy<0)&&(s=Math.abs(p)>Math.abs(i.dy)?p/2:p),a===_/2&&s===p/2&&(a=r,s=c)}return[[a,s],[r,c]]},An=function(t){var n=t.type,e=t.connectorData,i=t.subjectType;e||(e={}),e.points&&"number"!=typeof e.points||(e.points=Pn(n.annotation.offset,e.points)),e.curve||(e.curve=Kt);var o=[];if(n.editMode){var a=e.points.map(function(t,n){return vn({},function(t){var n=t.cx,e=void 0===n?0:n,i=t.cy;return{move:{x:e,y:void 0===i?0:i}}}({cx:t[0],cy:t[1]}),{index:n})});o=n.mapHandles(a.map(function(t){return vn({},t.move,{drag:function(t){e.points[t][0]+=x.dx,e.points[t][1]+=x.dy,n.redrawConnector()}.bind(n,t.index)})}))}var r=On({type:n,subjectType:i});return r=[r[0]].concat(function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}(e.points),[r[1]]),{components:[Nn({data:r,curve:e.curve,className:"connector"})],handles:o}},Pn=function(t){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,e=t.x/(n+1),i=t.y/(n+1),o=[],a=1;a<=n;a++)o.push([e*a+a%2*20,i*a-a%2*20]);return o},En=function(t){var n=t.subjectData,e=t.type;n.radius||n.outerRadius||(n.radius=20);var i=[],o=Tn({data:n,className:"subject"});if(e.editMode){var a=function(t){var n=t.cx,e=void 0===n?0:n,i=t.cy,o=void 0===i?0:i,a=t.r1,r=t.r2,s=t.padding,c={move:{x:e,y:o}};return void 0!==a&&(c.r1={x:e+a/Math.sqrt(2),y:o+a/Math.sqrt(2)}),void 0!==r&&(c.r2={x:e+r/Math.sqrt(2),y:o+r/Math.sqrt(2)}),void 0!==s&&(c.padding={x:e+a+s,y:o}),c}({r1:o.data.outerRadius||o.data.radius,r2:o.data.innerRadius,padding:n.radiusPadding}),r=function(t){var i=n[t]+x.dx*Math.sqrt(2);n[t]=i,e.redrawSubject(),e.redrawConnector()},s=[vn({},a.r1,{drag:r.bind(e,void 0!==n.outerRadius?"outerRadius":"radius")})];n.innerRadius&&s.push(vn({},a.r2,{drag:r.bind(e,"innerRadius")})),i=e.mapHandles(s)}return o.attrs["fill-opacity"]=0,{components:[o],handles:i}},Cn=function(){function t(n){var e=n.a,i=n.annotation,o=n.editMode,a=n.dispatcher,r=n.notePadding,s=n.accessors;if(yn(this,t),this.a=e,this.note=-1===i.disable.indexOf("note")&&e.select("g.annotation-note"),this.noteContent=this.note&&e.select("g.annotation-note-content"),this.connector=-1===i.disable.indexOf("connector")&&e.select("g.annotation-connector"),this.subject=-1===i.disable.indexOf("subject")&&e.select("g.annotation-subject"),this.dispatcher=a,a){var c=Ln.bind(null,a,i);c({component:this.note,name:"note"}),c({component:this.connector,name:"connector"}),c({component:this.subject,name:"subject"})}this.annotation=i,this.editMode=i.editMode||o,this.notePadding=void 0!==r?r:3,this.offsetCornerX=0,this.offsetCornerY=0,s&&i.data&&this.init(s)}return dn(t,[{key:"init",value:function(t){this.annotation.x||this.mapX(t),this.annotation.y||this.mapY(t)}},{key:"mapY",value:function(t){t.y&&(this.annotation.y=t.y(this.annotation.data))}},{key:"mapX",value:function(t){t.x&&(this.annotation.x=t.x(this.annotation.data))}},{key:"updateEditMode",value:function(){this.a.selectAll("circle.handle").remove()}},{key:"drawOnSVG",value:function(t,n){var e=this;Array.isArray(n)||(n=[n]),n.filter(function(t){return t}).forEach(function(n){var i=n.type,o=n.className,a=n.attrs,r=n.handles,s=n.classID;if("handle"===i)!function(t){var n=t.group,e=t.handles,i=t.r,o=void 0===i?10:i,a=n.selectAll("circle.handle").data(e);a.enter().append("circle").attr("class","handle").attr("fill","grey").attr("fill-opacity",.1).attr("cursor","move").attr("stroke-dasharray",5).attr("stroke","grey").call(pt().container(Q("g.annotations").node()).on("start",function(t){return t.start&&t.start(t)}).on("drag",function(t){return t.drag&&t.drag(t)}).on("end",function(t){return t.end&&t.end(t)})),n.selectAll("circle.handle").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",function(t){return t.r||o}).attr("class",function(t){return"handle "+(t.className||"")}),a.exit().remove()}({group:t,r:a&&a.r,handles:r});else{zn(t,[e.annotation],i,o,s);for(var c=t.select(i+"."+(s||o)),h=Object.keys(a),u=[],l=c.node().attributes,f=l.length-1;f>=0;f--){var _=l[f].name;-1===h.indexOf(_)&&"class"!==_&&u.push(_)}h.forEach(function(t){"text"===t?c.text(a[t]):c.attr(t,a[t])}),u.forEach(function(t){return c.attr(t,null)})}})}},{key:"getNoteBBox",value:function(){return Xn(this.note,".annotation-note-content text")}},{key:"getNoteBBoxOffset",value:function(){var t=Xn(this.note,".annotation-note-content"),n=this.noteContent.attr("transform").split(/\(|\,|\)/g);return t.offsetCornerX=parseFloat(n[1])+this.annotation.dx,t.offsetCornerY=parseFloat(n[2])+this.annotation.dy,t.offsetX=this.annotation.dx,t.offsetY=this.annotation.dy,t}},{key:"drawSubject",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.annotation.subject,i=n.type,o={type:this,subjectData:e},a={};"circle"===i?a=En(o):"rect"===i?a=function(t){var n=t.subjectData,e=t.type;n.width||(n.width=100),n.height||(n.height=100);var i=[],o=n.width,a=n.height,r=Nn({data:[[0,0],[o,0],[o,a],[0,a],[0,0]],className:"subject"});if(e.editMode){var s=[{x:o,y:a/2,drag:function(){n.width=x.x,e.redrawSubject(),e.redrawConnector()}.bind(e)},{x:o/2,y:a,drag:function(){n.height=x.y,e.redrawSubject(),e.redrawConnector()}.bind(e)}];i=e.mapHandles(s)}return r.attrs["fill-opacity"]=.1,{components:[r],handles:i}}(o):"threshold"===i?a=function(t){var n=t.subjectData,e=t.type.annotation.position,i=(void 0!==n.x1?n.x1:e.x)-e.x,o=(void 0!==n.x2?n.x2:e.x)-e.x,a=(void 0!==n.y1?n.y1:e.y)-e.y,r=(void 0!==n.y2?n.y2:e.y)-e.y;return{components:[Nn({data:[[i,a],[o,r]],className:"subject"})]}}(o):"badge"===i&&(a=function(t){var n=t.subjectData,e=void 0===n?{}:n,i=t.type,o=void 0===i?{}:i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=o.typeSettings&&o.typeSettings.subject;e.radius||(r&&r.radius?e.radius=r.radius:e.radius=14),e.x||r&&r.x&&(e.x=r.x),e.y||r&&r.y&&(e.y=r.y);var s=[],c=[],h=e.radius,u=.7*h,l=0,f=0,_=Math.sqrt(2)*h,p={xleftcorner:-h,xrightcorner:h,ytopcorner:-h,ybottomcorner:h,xleft:-_,xright:_,ytop:-_,ybottom:_};e.x&&!e.y?l=p["x"+e.x]:e.y&&!e.x?f=p["y"+e.y]:e.x&&e.y&&(l=p["x"+e.x+"corner"],f=p["y"+e.y+"corner"]);var y="translate("+l+", "+f+")",d=Tn({className:"subject",data:{radius:h}});d.attrs.transform=y,d.attrs.fill=a.color,d.attrs["stroke-linecap"]="round",d.attrs["stroke-width"]="3px";var v=Tn({className:"subject-ring",data:{outerRadius:h,innerRadius:u}});v.attrs.transform=y,v.attrs["stroke-width"]="3px",v.attrs.fill="white";var g=void 0;if(l&&f||!l&&!f)g=Nn({className:"subject-pointer",data:[[0,0],[l||0,0],[0,f||0],[0,0]]});else if(l||f){var m=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t&&t/Math.sqrt(2)/Math.sqrt(2)||n*h/Math.sqrt(2)};g=Nn({className:"subject-pointer",data:[[0,0],[m(l),m(f)],[m(l,-1),m(f,-1)],[0,0]]})}if(g&&(g.attrs.fill=a.color,g.attrs["stroke-linecap"]="round",g.attrs["stroke-width"]="3px",c.push(g)),o.editMode){var b={x:2*l,y:2*f,drag:function(){e.x=x.x<2*-h?"left":x.x>2*h?"right":void 0,e.y=x.y<2*-h?"top":x.y>2*h?"bottom":void 0,o.redrawSubject()}.bind(o)};b.x||b.y||(b.y=-h),s=o.mapHandles([b])}var w=void 0;return e.text&&(w={type:"text",className:"badge-text",attrs:{fill:"white",stroke:"none","font-size":".7em",text:e.text,"text-anchor":"middle",dy:".25em",x:l,y:f}}),c.push(d),c.push(v),c.push(w),{components:c,handles:s}}(o,this.annotation));var r=a,s=r.components,c=void 0===s?[]:s,h=r.handles,u=void 0===h?[]:h;return c.forEach(function(n){n&&n.attrs&&!n.attrs.stroke&&(n.attrs.stroke=t.annotation.color)}),this.editMode&&(u=u.concat(this.mapHandles([{drag:this.dragSubject.bind(this)}])),c.push({type:"handle",handles:u})),c}},{key:"drawConnector",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.annotation.connector,i=e.type||n.type,o={type:this,connectorData:e};o.subjectType=this.typeSettings&&this.typeSettings.subject&&this.typeSettings.subject.type;var a="curve"===i?An(o):"elbow"===i?function(t){var n=t.type,e=t.subjectType,i=n.annotation,o=i.position,a=i.x-o.x,r=a+i.dx,s=i.y-o.y,c=s+i.dy,h=i.subject;if("rect"===e){var u=h.width,l=h.height;(u>0&&i.dx>0||u<0&&i.dx<0)&&(a=Math.abs(u)>Math.abs(i.dx)?u/2:u),(l>0&&i.dy>0||l<0&&i.dy<0)&&(s=Math.abs(l)>Math.abs(i.dy)?l/2:l),a===u/2&&s===l/2&&(a=r,s=c)}var f=[[a,s],[r,c]],_=c-s,p=r-a,y=r,d=c,v=c<s&&r>a||r<a&&c>s?-1:1;if(Math.abs(p)<Math.abs(_)?(y=r,d=s+p*v):(d=c,y=a+_*v),"circle"===e&&(h.outerRadius||h.radius)){var x=(h.outerRadius||h.radius)+(h.radiusPadding||0),g=x/Math.sqrt(2);if(Math.abs(p)>g&&Math.abs(_)>g)f=[[a=g*(r<0?-1:1),s=g*(c<0?-1:1)],[y,d],[r,c]];else if(Math.abs(p)>Math.abs(_)){var m=Math.asin(-c/x);f=[[a=Math.abs(Math.cos(m)*x)*(r<0?-1:1),c],[r,c]]}else{var b=Math.acos(r/x);f=[[r,s=Math.abs(Math.sin(b)*x)*(c<0?-1:1)],[r,c]]}}else f=[[a,s],[y,d],[r,c]];return{components:[Nn({data:f,className:"connector"})]}}(o):function(t){var n=On(t);return{components:[Nn({data:n,className:"connector"})]}}(o),r=a.components,s=void 0===r?[]:r,c=a.handles,h=void 0===c?[]:c,u=s[0];u&&(u.attrs.stroke=this.annotation.color,u.attrs.fill="none");var l=e.end||n.end,f={};if("arrow"===l){var _=u.data[1],p=u.data[0];Math.sqrt(Math.pow(_[0]-p[0],2)+Math.pow(_[1]-p[1],2))<5&&u.data[2]&&(_=u.data[2]),f=function(t){var n=t.annotation,e=t.start,i=t.end,o=t.scale,a=void 0===o?1:o,r=n.position;e=e?[-i[0]+e[0],-i[1]+e[1]]:[n.dx,n.dy],i||(i=[n.x-r.x,n.y-r.y]);var s=i[0],c=i[1],h=e[0],u=e[1],l=10*a,f=16/180*Math.PI,_=Math.atan(u/h);h<0&&(_+=Math.PI);var p=[[s,c],[Math.cos(_+f)*l+s,Math.sin(_+f)*l+c],[Math.cos(_-f)*l+s,Math.sin(_-f)*l+c],[s,c]];return{components:[Nn({data:p,className:"connector-end connector-arrow",classID:"connector-end"})]}}({annotation:this.annotation,start:_,end:p,scale:e.endScale})}else"dot"===l?f=function(t){var n=t.line,e=t.scale,i=void 0===e?1:e,o=Tn({className:"connector-end connector-dot",classID:"connector-end",data:{radius:3*Math.sqrt(i)}});return o.attrs.transform="translate("+n.data[0][0]+", "+n.data[0][1]+")",{components:[o]}}({line:u,scale:e.endScale}):l&&"none"!==l||this.connector&&this.connector.select(".connector-end").remove();return f.components&&(f.components.forEach(function(n){n.attrs.fill=t.annotation.color,n.attrs.stroke=t.annotation.color}),s=s.concat(f.components)),this.editMode&&0!==h.length&&s.push({type:"handle",handles:h}),s}},{key:"drawNote",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.annotation.note,i=e.align||n.align||"dynamic",o={bbox:n.bbox,align:i,offset:this.annotation.offset},a=e.lineType||n.lineType,r={};"vertical"===a?r=function(t){var n=t.align,e=t.x,i=void 0===e?0:e,o=t.y,a=void 0===o?0:o,r=t.bbox,s=t.offset;"top"===(n=Mn(n,s.y))?a-=r.height:"middle"===n&&(a-=r.height/2);var c=[[i,a],[i,a+r.height]];return{components:[Nn({data:c,className:"note-line"})]}}(o):"horizontal"===a&&(r=function(t){var n=t.align,e=t.x,i=void 0===e?0:e,o=t.y,a=void 0===o?0:o,r=t.offset,s=t.bbox;"right"===(n=jn(n,r.x))?i-=s.width:"middle"===n&&(i-=s.width/2);var c=[[i,a],[i+s.width,a]];return{components:[Nn({data:c,className:"note-line"})]}}(o));var s=r,c=s.components,h=void 0===c?[]:c,u=s.handles,l=void 0===u?[]:u;if(h.forEach(function(n){n.attrs.stroke=t.annotation.color}),this.editMode){l=this.mapHandles([{x:0,y:0,drag:this.dragNote.bind(this)}]),h.push({type:"handle",handles:l});var f=this.dragNote.bind(this),_=this.dragstarted.bind(this),p=this.dragended.bind(this);this.note.call(pt().container(Q("g.annotations").node()).on("start",function(t){return _(t)}).on("drag",function(t){return f(t)}).on("end",function(t){return p(t)}))}else this.note.on("mousedown.drag",null);return h}},{key:"drawNoteContent",value:function(t){var n=this.annotation.note,e=void 0!==n.padding?n.padding:this.notePadding,i=n.orientation||t.orientation||"topBottom",o=n.lineType||t.lineType,a=n.align||t.align||"dynamic";"vertical"===o?i="leftRight":"horizontal"===o&&(i="topBottom");var r=function(t){var n=t.padding,e=void 0===n?0:n,i=t.bbox,o=void 0===i?{x:0,y:0,width:0,height:0}:i,a=t.align,r=t.orientation,s=t.offset,c=void 0===s?{x:0,y:0}:s,h=-o.x,u=0;return-1!==kn.indexOf(r)?(a=jn(a,c.x),c.y<0&&"topBottom"===r||"top"===r?u-=o.height+e:u+=e,"middle"===a?h-=o.width/2:"right"===a&&(h-=o.width)):-1!==Sn.indexOf(r)&&(a=Mn(a,c.y),c.x<0&&"leftRight"===r||"left"===r?h-=o.width+e:h+=e,"middle"===a?u-=o.height/2:"top"===a&&(u-=o.height)),{x:h,y:u}}({padding:e,bbox:t.bbox,offset:this.annotation.offset,orientation:i,align:a}),s=r.x,c=r.y;return this.offsetCornerX=s+this.annotation.dx,this.offsetCornerY=c+this.annotation.dy,this.note&&this.noteContent.attr("transform","translate("+s+", "+c+")"),[]}},{key:"drawOnScreen",value:function(t,n){return this.drawOnSVG(t,n)}},{key:"redrawSubject",value:function(){this.subject&&this.drawOnScreen(this.subject,this.drawSubject())}},{key:"redrawConnector",value:function(){this.connector&&this.drawOnScreen(this.connector,this.drawConnector())}},{key:"redrawNote",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getNoteBBox();this.noteContent&&this.drawOnScreen(this.noteContent,this.drawNoteContent({bbox:t})),this.note&&this.drawOnScreen(this.note,this.drawNote({bbox:t}))}},{key:"setPosition",value:function(){var t=this.annotation.position;this.a.attr("transform","translate("+t.x+", "+t.y+")")}},{key:"clearComponents",value:function(){this.subject&&this.subject.select("*").remove(),this.connector&&this.connector.select("*").remove()}},{key:"setOffset",value:function(){if(this.note){var t=this.annotation.offset;this.note.attr("transform","translate("+t.x+", "+t.y+")")}}},{key:"setPositionWithAccessors",value:function(t){t&&this.annotation.data&&(this.mapX(t),this.mapY(t)),this.setPosition()}},{key:"setClassName",value:function(){this.a.attr("class","annotation "+(this.className&&this.className())+" "+(this.editMode?"editable":"")+" "+(this.annotation.className||""))}},{key:"draw",value:function(){this.setClassName(),this.setPosition(),this.setOffset(),this.redrawSubject(),this.redrawConnector(),this.redrawNote()}},{key:"dragstarted",value:function(){x.sourceEvent.stopPropagation(),this.dispatcher&&this.dispatcher.call("dragstart",this.a,this.annotation),this.a.classed("dragging",!0),this.a.selectAll("circle.handle").style("pointer-events","none")}},{key:"dragended",value:function(){this.dispatcher&&this.dispatcher.call("dragend",this.a,this.annotation),this.a.classed("dragging",!1),this.a.selectAll("circle.handle").style("pointer-events","all")}},{key:"dragSubject",value:function(){var t=this.annotation.position;t.x+=x.dx,t.y+=x.dy,this.annotation.position=t}},{key:"dragNote",value:function(){var t=this.annotation.offset;t.x+=x.dx,t.y+=x.dy,this.annotation.offset=t}},{key:"mapHandles",value:function(t){var n=this;return t.map(function(t){return vn({},t,{start:n.dragstarted.bind(n),end:n.dragended.bind(n)})})}}]),t}(),qn=function(t,n,e){return function(i){function o(t){yn(this,o);var e=mn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));return e.typeSettings=n,n.disable&&n.disable.forEach(function(t){e[t]&&e[t].remove(),e[t]=void 0,"note"===t&&(e.noteContent=void 0)}),e}return gn(o,t),dn(o,[{key:"className",value:function(){return""+(n.className||xn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"className",this)&&xn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"className",this).call(this)||"")}},{key:"drawSubject",value:function(t){return this.typeSettings.subject=vn({},n.subject,this.typeSettings.subject),xn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawSubject",this).call(this,vn({},t,this.typeSettings.subject))}},{key:"drawConnector",value:function(t){return this.typeSettings.connector=vn({},n.connector,this.typeSettings.connector),xn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawConnector",this).call(this,vn({},t,n.connector,this.typeSettings.connector))}},{key:"drawNote",value:function(t){return this.typeSettings.note=vn({},n.note,this.typeSettings.note),xn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawNote",this).call(this,vn({},t,n.note,this.typeSettings.note))}},{key:"drawNoteContent",value:function(t){return xn(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"drawNoteContent",this).call(this,vn({},t,n.note,this.typeSettings.note))}}],[{key:"init",value:function(t,n){return xn(o.__proto__||Object.getPrototypeOf(o),"init",this).call(this,t,n),e&&(t=e(t,n)),t}}]),o}()},Rn=function(t){function n(t){yn(this,n);var e=mn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.textWrap=t.textWrap||120,e.drawText(),e}return gn(n,Cn),dn(n,[{key:"updateTextWrap",value:function(t){this.textWrap=t,this.drawText()}},{key:"drawText",value:function(){if(this.note){zn(this.note,[this.annotation],"g","annotation-note-content");var t=this.note.select("g.annotation-note-content");zn(t,[this.annotation],"rect","annotation-note-bg"),zn(t,[this.annotation],"text","annotation-note-label"),zn(t,[this.annotation],"text","annotation-note-title");var n={height:0},e=this.a.select("text.annotation-note-label"),i=this.annotation.note&&this.annotation.note.wrap||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrap||this.textWrap,o=this.annotation.note&&this.annotation.note.wrapSplitter||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.wrapSplitter,a=this.annotation.note&&this.annotation.note.bgPadding||this.typeSettings&&this.typeSettings.note&&this.typeSettings.note.bgPadding,r={top:0,bottom:0,left:0,right:0};if("number"==typeof a?r={top:a,bottom:a,left:a,right:a}:a&&"object"===(void 0===a?"undefined":pn(a))&&(r=vn(r,a)),this.annotation.note.title){var s=this.a.select("text.annotation-note-title");s.text(this.annotation.note.title),s.attr("fill",this.annotation.color),s.attr("font-weight","bold"),s.call(Wn,i,o),n=s.node().getBBox()}e.text(this.annotation.note.label).attr("dx","0"),e.call(Wn,i,o),e.attr("y",1.1*n.height||0),e.attr("fill",this.annotation.color);var c=this.getNoteBBox();this.a.select("rect.annotation-note-bg").attr("width",c.width+r.left+r.right).attr("height",c.height+r.top+r.bottom).attr("x",c.x-r.left).attr("y",-r.top).attr("fill","white").attr("fill-opacity",0)}}}]),n}(),Dn=(qn(Rn,{className:"label",note:{align:"middle"}}),qn(Rn,{className:"callout",note:{lineType:"horizontal"}})),In=(qn(Dn,{className:"callout elbow",connector:{type:"elbow"}}),qn(Dn,{className:"callout curve",connector:{type:"curve"}})),Bn=(qn(Cn,{className:"badge",subject:{type:"badge"},disable:["connector","note"]}),qn(Rn,{className:"callout circle",subject:{type:"circle"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),qn(Rn,{className:"callout rect",subject:{type:"rect"},note:{lineType:"horizontal"},connector:{type:"elbow"}}),function(t){function n(){return yn(this,n),mn(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return gn(n,Dn),dn(n,[{key:"mapY",value:function(t){xn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"mapY",this).call(this,t);var e=this.annotation;(e.subject.x1||e.subject.x2)&&e.data&&t.y&&(e.y=t.y(e.data)),!e.subject.x1&&!e.subject.x2||e.x||(e.x=e.subject.x1||e.subject.x2)}},{key:"mapX",value:function(t){xn(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"mapX",this).call(this,t);var e=this.annotation;(e.subject.y1||e.subject.y2)&&e.data&&t.x&&(e.x=t.x(e.data)),!e.subject.y1&&!e.subject.y2||e.y||(e.y=e.subject.y1||e.subject.y2)}}]),n}()),zn=(qn(Bn,{className:"callout xythreshold",subject:{type:"threshold"}}),function(t,n,e,i,o){var a=t.selectAll(e+"."+(o||i)).data(n);return a.enter().append(e).merge(a).attr("class",i),a.exit().remove(),t}),Ln=function(t,n,e){var i=e.component,o=e.name;i&&i.on("mouseover.annotations",function(){t.call(o+"over",i,n)}).on("mouseout.annotations",function(){return t.call(o+"out",i,n)}).on("click.annotations",function(){return t.call(o+"click",i,n)})},Wn=function(t,n,e){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.2;t.each(function(){for(var t=Q(this),o=t.text().split(e||/[ \t\r\n]+/).reverse().filter(function(t){return""!==t}),a=void 0,r=[],s=t.text(null).append("tspan").attr("x",0).attr("dy","0.8em");a=o.pop();)r.push(a),s.text(r.join(" ")),s.node().getComputedTextLength()>n&&r.length>1&&(r.pop(),s.text(r.join(" ")),r=[a],s=t.append("tspan").attr("x",0).attr("dy",i+"em").text(a))})},Xn=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:":not(.handle)";return t?t.selectAll(n).nodes().reduce(function(t,n){var e=n.getBBox();t.x=Math.min(t.x,e.x),t.y=Math.min(t.y,e.y),t.width=Math.max(t.width,e.width);var i=n&&n.attributes&&n.attributes.y;return t.height=Math.max(t.height,(i&&parseFloat(i.value)||0)+e.height),t},{x:0,y:0,width:0,height:0}):{x:0,y:0,width:0,height:0}};function Yn(){var t=[],n=void 0,e=void 0,i=[],o={},a={},r=!1,s=void 0,c=Dn,h=void 0,u=void 0,l=at("subjectover","subjectout","subjectclick","connectorover","connectorout","connectorclick","noteover","noteout","noteclick","dragend","dragstart"),f=void 0,_=function(e){f=e,r||e.selectAll("circle.handle").remove();var _=t.map(function(t){return t.type||(t.type=c),t.disable||(t.disable=i),new bn(t)});n=n||new wn({annotations:_,accessors:o,accessorsInverse:a,ids:s}),e.selectAll("g").data([n]).enter().append("g").attr("class","annotations");var p=e.select("g.annotations");zn(p,n.annotations,"g","annotation");var y=p.selectAll("g.annotation");y.each(function(t){var n=Q(this);n.attr("class","annotation"),zn(n,[t],"g","annotation-connector"),zn(n,[t],"g","annotation-subject"),zn(n,[t],"g","annotation-note"),zn(n.select("g.annotation-note"),[t],"g","annotation-note-content"),t.type="[object Object]"===t.type.toString()?t.type:new t.type({a:n,annotation:t,textWrap:h,notePadding:u,editMode:r,dispatcher:l,accessors:o}),t.type.draw(),t.type.drawText&&t.type.drawText()})};return _.json=function(){return console.log("Annotations JSON was copied to your clipboard. Please note the annotation type is not JSON compatible. It appears in the objects array in the console, but not in the copied JSON.",n.json),window.copy(JSON.stringify(n.json.map(function(t){return delete t.type,t}))),_},_.update=function(){return t&&n&&(t=n.annotations.map(function(t){return t.type.draw(),t})),_},_.updateText=function(){return n&&(n.updateText(h),t=n.annotations),_},_.updatedAccessors=function(){return n.setPositionWithAccessors(),t=n.annotations,_},_.disable=function(e){return arguments.length?(i=e,n&&(n.updateDisable(i),t=n.annotations),_):i},_.textWrap=function(e){return arguments.length?(h=e,n&&(n.updateTextWrap(h),t=n.annotations),_):h},_.notePadding=function(e){return arguments.length?(u=e,n&&(n.updateNotePadding(u),t=n.annotations),_):u},_.type=function(e,i){return arguments.length?(c=e,n&&(n.annotations.map(function(t){t.type.note&&t.type.note.selectAll("*:not(.annotation-note-content)").remove(),t.type.noteContent&&t.type.noteContent.selectAll("*").remove(),t.type.subject&&t.type.subject.selectAll("*").remove(),t.type.connector&&t.type.connector.selectAll("*").remove(),t.type.typeSettings={},t.type=c,t.subject=i&&i.subject||t.subject,t.connector=i&&i.connector||t.connector,t.note=i&&i.note||t.note}),t=n.annotations),_):c},_.annotations=function(e){if(!arguments.length)return n&&n.annotations||t;(t=e,n&&n.annotations)&&(t.some(function(t){return!t.type||"[object Object]"!==t.type.toString()})?(n=null,_(f)):n.annotations=t);return _},_.context=function(t){return arguments.length?(e=t,_):e},_.accessors=function(t){return arguments.length?(o=t,_):o},_.accessorsInverse=function(t){return arguments.length?(a=t,_):a},_.ids=function(t){return arguments.length?(s=t,_):s},_.editMode=function(e){return arguments.length?(r=e,f&&f.selectAll("g.annotation").classed("editable",r),n&&(n.editMode(r),t=n.annotations),_):r},_.collection=function(t){return arguments.length?(n=t,_):n},_.on=function(){var t=l.on.apply(l,arguments);return t===l?_:t},_}function Hn(t){return function(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Vn(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=[],i=!0,o=!1,a=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done)&&(e.push(r.value),!n||e.length!==n);i=!0);}catch(t){o=!0,a=t}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return e}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Fn(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var Jn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Un=4/3,Gn=320,$n=[],Zn=[],Qn=d3.select("#timeline"),Kn=Qn.select(".figure__chart"),te=Qn.select(".figure__annotation"),ne=0,ee=0,ie=0;function oe(){var t=d3.select(this),n=t.select(".annotation-connector");n.classed("annotation-connector--bg",!0);var e=n.html();t.append("g.annotation-connector.annotation-connector--fg").html(e)}function ae(){var t=Qn.select(".year");if(t.size()){var n=Qn.node().offsetWidth,e=t.node().offsetWidth,i=(n-e)/2,o=n-i;te.st("width",o),ee=(ne=e/12)/Un,Qn.selectAll(".flag").st({width:ne,height:ee}),ie=Math.min(.8*i,Gn),function(t){te.select(".g-annotation").remove();var n=te.append("g.g-annotation"),e=qn(In,{className:"custom",connector:{type:"curve",end:"arrow"},note:{lineType:"horizontal",align:"left"}}),i=t.map(function(t){return{note:{title:t.year,label:t.label,padding:0,wrap:ie,bgPadding:{top:5,left:5,right:5,bottom:5}},data:{yearOff:t.year-1900,month:t.month},dx:(12-t.month)*ne+ne,dy:3*ee,connector:{points:1}}}),o=Yn().type(e).accessors({x:function(t){return t.month*ne-ne/2},y:function(t){return t.yearOff*ee+ee/2+t.yearOff/2}}).annotations(i);n.call(o),n.selectAll(".annotation").each(oe)}([{year:1907,month:6,label:d3.range(100).map(function(){return"m"}).join(" ")}])}}function re(){ae()}function se(t){return t.map(function(t){return function(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{},i=Object.keys(e);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.forEach(function(n){Fn(t,n,e[n])})}return t}({},t,{ccn3:+t.ccn3,lat:+t.latlng.split(",")[0].trim(),commonLower:t.common.toLowerCase(),lng:+t.latlng.split(",")[1].trim()})})}function ce(){var t,n=["month"].map(function(t){return"assets/data/result--".concat(t,".csv")});(t=d3).loadData.apply(t,Hn(n).concat([function(t,n){t&&console.log(t),Zn=function(t){var n,e=Vn(d3.extent(t,function(t){return+t.year}),2),i=e[0],o=e[1],a=d3.range(i,o+1).map(function(t){return d3.range(Jn.length).map(function(n){return{year:t,month:n+1}})});return(n=[]).concat.apply(n,Hn(a)).map(function(n){return t.find(function(t){return+t.year===n.year&&+t.month===n.month})||{year:n.year.toString(),month:d3.format("02")(n.month),country:"N/A",count:0}})}(n[0].filter(function(t){return+t.year<2018})),function(){var t=d3.nest().key(function(t){return t.year}).entries(Zn),n=Kn.selectAll(".year").data(t).enter().append("div.year");n.append("h3.title").text(function(t){return t.key});var e=n.append("ul").selectAll("li").data(function(t){return t.values}).enter().append("li");e.append("span.month").text(function(t){return Jn[+t.month-1]}),e.append("span.flag").html(function(t){var n=($n.find(function(n){return n.commonLower===t.country})||{cca2:"none"}).cca2;return'<img src="assets/flags/jpg-4x3-192-q70/'.concat(n.toLowerCase(),'.jpg">')}),e.append("span.name").text(function(t){var n=$n.find(function(n){return n.commonLower===t.country});return n?n.common:t.country})}(),ae(),re()}]))}var he={init:function(){var t,n=["countries.csv"].map(function(t){return"assets/data/".concat(t)});(t=d3).loadData.apply(t,Hn(n).concat([function(t,n){t&&console.log(t),$n=se(n[0]),ce()}]))},resize:re},ue=d3.select("body"),le=0;function fe(){var t=ue.node().offsetWidth;le!==t&&(le=t,he.resize())}ue.classed("is-mobile",r.any()),window.addEventListener("resize",o()(fe,150)),function(){if(ue.select("header").classed("is-sticky")){var t=ue.select(".header__menu"),n=ue.select(".header__toggle");n.on("click",function(){var e=t.classed("is-visible");t.classed("is-visible",!e),n.classed("is-visible",!e)})}}(),he.init()},2:function(t,n,e){(function(n){var e="Expected a function",i=NaN,o="[object Symbol]",a=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,h=parseInt,u="object"==typeof n&&n&&n.Object===Object&&n,l="object"==typeof self&&self&&self.Object===Object&&self,f=u||l||Function("return this")(),_=Object.prototype.toString,p=Math.max,y=Math.min,d=function(){return f.Date.now()};function v(t){var n=typeof t;return!!t&&("object"==n||"function"==n)}function x(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&_.call(t)==o}(t))return i;if(v(t)){var n="function"==typeof t.valueOf?t.valueOf():t;t=v(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var e=s.test(t);return e||c.test(t)?h(t.slice(2),e?2:8):r.test(t)?i:+t}t.exports=function(t,n,i){var o,a,r,s,c,h,u=0,l=!1,f=!1,_=!0;if("function"!=typeof t)throw new TypeError(e);function g(n){var e=o,i=a;return o=a=void 0,u=n,s=t.apply(i,e)}function m(t){var e=t-h;return void 0===h||e>=n||e<0||f&&t-u>=r}function b(){var t=d();if(m(t))return w(t);c=setTimeout(b,function(t){var e=n-(t-h);return f?y(e,r-(t-u)):e}(t))}function w(t){return c=void 0,_&&o?g(t):(o=a=void 0,s)}function M(){var t=d(),e=m(t);if(o=arguments,a=this,h=t,e){if(void 0===c)return function(t){return u=t,c=setTimeout(b,n),l?g(t):s}(h);if(f)return c=setTimeout(b,n),g(h)}return void 0===c&&(c=setTimeout(b,n)),s}return n=x(n)||0,v(i)&&(l=!!i.leading,r=(f="maxWait"in i)?p(x(i.maxWait)||0,n):r,_="trailing"in i?!!i.trailing:_),M.cancel=function(){void 0!==c&&clearTimeout(c),u=0,o=h=a=c=void 0},M.flush=function(){return void 0===c?s:w(d())},M}}).call(this,e(0))}});